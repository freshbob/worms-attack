<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: tcp_old::TCPConnection Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacetcp__old.html">tcp_old</a>::<a class="el" href="classtcp__old_1_1_t_c_p_connection.html">TCPConnection</a>
  </div>
</div>
<div class="contents">
<h1>tcp_old::TCPConnection Class Reference</h1><!-- doxytag: class="tcp_old::TCPConnection" -->
<p><code>#include &lt;TCPConnection_old.h&gt;</code></p>

<p><a href="classtcp__old_1_1_t_c_p_connection-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab2cbccc16b2f006369a83c51426e4bc5">sendData</a> (bool fullSegmentsOnly, int congestionWindow=-1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment</a> (bool called_at_rto)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a> (uint32 seqNo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a3dc25263bb2f0b1013ee398c1587b128">sendRst</a> (uint32 seq, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest, int srcPort, int destPort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck</a> (uint32 seq, uint32 ack, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest, int srcPort, int destPort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a> (uint32 bytes)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a> (const char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a264eb196b44591ed68422a9e70dab680">signalConnectionTimeout</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a> (cMessage *msg, simtime_t timeout)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection</a> (<a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> *mod, int <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">appGateIndex</a>, int <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpSeg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> srcAddr, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> destAddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand</a> (cMessage *msg)</td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrpd41d8cd98f00b204e9800998ecf8427e"></a> </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a55abadf8c9f66428b7f6db8fa90d1af3">getFsmState</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p_state_variables.html">TCPStateVariables</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a1704500b72eb201d9119192ebb9b4923">getState</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p_send_queue.html">TCPSendQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a15a684dc0613b455e92c0ae57a00f177">getSendQueue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab9c0058b4df0583d36fd462e71c3120d">getReceiveQueue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p_algorithm.html">TCPAlgorithm</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a11c0933a5657daacb6cbc27de282187f">getTcpAlgorithm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a5ba299a7999e64fe67e8fef5f62c2402">getTcpMain</a> ()</td></tr>
<tr><td colspan="2"><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a> (int <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a> (int event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a> (int code)</td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">appGateIndex</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classtcp__old_1_1_t_c_p_connection.html">TCPConnection</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a> (<a class="el" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a> (int code)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a> ()</td></tr>
<tr><td colspan="2"><div class="groupHeader">FSM transitions: analysing events and executing state transitions</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp52261dc2667793c40346362ca3dc011c"></a> </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a792d9159b4e64b344cac79d0716c907a">preanalyseAppCommandEvent</a> (int commandCode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a> (const <a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered</a> (int <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing app commands. Invoked from processAppCommand().</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrpf0aace6d2184c496338bf0629165a07b"></a> </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE</a> (<a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE</a> (<a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND</a> (<a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE</a> (<a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT</a> (<a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS</a> (<a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing TCP segment arrivals. Invoked from processTCPSegment().</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp5d91dcf8ebf758ad360bdfc9a638a31d"></a> </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a9b7d3f811eab0367d3826dfb20c8d931">tryFastRoute</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing timeouts. Invoked from processTimer().</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp4a0f56bc2108064113507ad06d79aca2"></a> </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae29072ef963e593c4c3053827ebbec6e">process_TIMEOUT_2MSL</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT</a> (<a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;event)</td></tr>
<tr><td colspan="2"><h2>Static Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a8763146770969da7d0a1196efe23615c">sendToIP</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cFSM&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p_state_variables.html">TCPStateVariables</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p_send_queue.html">TCPSendQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtcp__old_1_1_t_c_p_algorithm.html">TCPAlgorithm</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a946bf6fc849e9554b489e5fff58be513">sndNxtVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#afe2cc9a34e2074f95626e4085236d561">sndAckVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#acb4230bb789e0bf3e413479e26316d60">rcvSeqVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a7b6c1fcdd10a035c035dea350420286d">rcvAckVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Manages a <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> connection. This class itself implements the <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> state machine as well as handling control PDUs (SYN, SYN+ACK, RST, FIN, etc.), timers (2MSL, CONN-ESTAB, FIN-WAIT-2) and events (OPEN, SEND, etc) associated with <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> state changes.</p>
<p>The implementation largely follows the functional specification at the end of RFC 793. Code comments extensively quote RFC 793 to make it easier to understand.</p>
<p><a class="el" href="classtcp__old_1_1_t_c_p_connection.html">TCPConnection</a> objects are not used alone -- they are instantiated and managed by a <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> module.</p>
<p><a class="el" href="classtcp__old_1_1_t_c_p_connection.html">TCPConnection</a> "outsources" several tasks to objects subclassed from <a class="el" href="classtcp__old_1_1_t_c_p_send_queue.html">TCPSendQueue</a>, <a class="el" href="classtcp__old_1_1_t_c_p_receive_queue.html">TCPReceiveQueue</a> and <a class="el" href="classtcp__old_1_1_t_c_p_algorithm.html">TCPAlgorithm</a>; see overview of this with <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> documentation.</p>
<p>Connection variables (TCB) are kept in <a class="el" href="classtcp__old_1_1_t_c_p_state_variables.html">TCPStateVariables</a>. <a class="el" href="classtcp__old_1_1_t_c_p_algorithm.html">TCPAlgorithm</a> implementations can extend <a class="el" href="classtcp__old_1_1_t_c_p_state_variables.html">TCPStateVariables</a> to add their own stuff (see <a class="el" href="classtcp__old_1_1_t_c_p_algorithm.html#ae8fdb9d455dc62709aa52ef616fb9ad9">TCPAlgorithm::createStateVariables()</a> factory method.)</p>
<p>The "entry points" of TCPConnnection from <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> are:</p>
<ul>
<li><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer(cMessage *msg)</a>: handle self-messages which belong to the connection</li>
<li><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment(TCPSegment *tcpSeg, IPvXAddress srcAddr, IPvXAddress destAddr)</a>: handle segment arrivals</li>
<li><a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand(cMessage *msg)</a>: process commands which arrive from the application (TCP_C_xxx)</li>
</ul>
<p>All three methods follow a common structure:</p>
<ol type="1">
<li>dispatch to specific methods. For example, <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a> invokes one of <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a> or <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, etc., and <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a> dispatches to <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a> or <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>. Those methods will do the REAL JOB.</li>
<li>after they return, we'll know the state machine event (TCPEventCode, TCP_E_xxx) for sure, so we can:</li>
<li>invoke <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a> which executes the necessary state transition (for example, TCP_E_RCV_SYN will take the state machine from TCP_S_LISTEN to TCP_S_SYN_RCVD). No other actions are taken in this step.</li>
<li>if there was a state change (for example, we entered the TCP_S_ESTABLISHED state), <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a> invokes <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, which performs some necessary housekeeping (cancel the CONN-ESTAB timer).</li>
</ol>
<p>When the CLOSED state is reached, <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> will delete the <a class="el" href="classtcp__old_1_1_t_c_p_connection.html">TCPConnection</a> object. </p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aab510bb961623a41ade36bfbda9f86b6"></a><!-- doxytag: member="tcp_old::TCPConnection::TCPConnection" ref="aab510bb961623a41ade36bfbda9f86b6" args="(TCP *mod, int appGateIndex, int connId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::TCPConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> *&nbsp;</td>
          <td class="paramname"> <em>mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>appGateIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>connId</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The "normal" constructor. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a> = _mod;
<a name="l00117"></a>00117     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">appGateIndex</a> = _appGateIndex;
<a name="l00118"></a>00118     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a> = _connId;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a> = -1;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <span class="keywordtype">char</span> fsmname[24];
<a name="l00123"></a>00123     sprintf(fsmname, <span class="stringliteral">&quot;fsm-%d&quot;</span>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a>);
<a name="l00124"></a>00124     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.setName(fsmname);
<a name="l00125"></a>00125     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.setState(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="comment">// queues and algorithm will be created on active or passive open</span>
<a name="l00129"></a>00129     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a> = NULL;
<a name="l00130"></a>00130     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a> = NULL;
<a name="l00131"></a>00131     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a> = NULL;
<a name="l00132"></a>00132     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a> = NULL;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;2MSL&quot;</span>);
<a name="l00135"></a>00135     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;CONN-ESTAB&quot;</span>);
<a name="l00136"></a>00136     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;FIN-WAIT-2&quot;</span>);
<a name="l00137"></a>00137     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;SYN-REXMIT&quot;</span>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00140"></a>00140     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00141"></a>00141     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00142"></a>00142     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="comment">// statistics</span>
<a name="l00145"></a>00145     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a> = NULL;
<a name="l00146"></a>00146     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a946bf6fc849e9554b489e5fff58be513">sndNxtVector</a> = NULL;
<a name="l00147"></a>00147     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afe2cc9a34e2074f95626e4085236d561">sndAckVector</a> = NULL;
<a name="l00148"></a>00148     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#acb4230bb789e0bf3e413479e26316d60">rcvSeqVector</a> = NULL;
<a name="l00149"></a>00149     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7b6c1fcdd10a035c035dea350420286d">rcvAckVector</a> = NULL;
<a name="l00150"></a>00150     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a> = NULL;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a5ba299a7999e64fe67e8fef5f62c2402">getTcpMain</a>()-&gt;recordStatistics)
<a name="l00153"></a>00153     {
<a name="l00154"></a>00154         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;send window&quot;</span>);
<a name="l00155"></a>00155         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a946bf6fc849e9554b489e5fff58be513">sndNxtVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;send seq&quot;</span>);
<a name="l00156"></a>00156         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afe2cc9a34e2074f95626e4085236d561">sndAckVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;sent ack&quot;</span>);
<a name="l00157"></a>00157         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#acb4230bb789e0bf3e413479e26316d60">rcvSeqVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd seq&quot;</span>);
<a name="l00158"></a>00158         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7b6c1fcdd10a035c035dea350420286d">rcvAckVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd ack&quot;</span>);
<a name="l00159"></a>00159         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;unacked bytes&quot;</span>);
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11a3cccb118b0b66bee1a07929510e4c"></a><!-- doxytag: member="tcp_old::TCPConnection::TCPConnection" ref="a11a3cccb118b0b66bee1a07929510e4c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::TCPConnection </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Note: this default ctor is NOT used to create live connections, only temporary ones so that TCPMain can invoke their <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed()</a>. </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00099"></a>00099 {
<a name="l00100"></a>00100     <span class="comment">// Note: this ctor is NOT used to create live connections, only</span>
<a name="l00101"></a>00101     <span class="comment">// temporary ones to invoke segmentArrivalWhileClosed() on</span>
<a name="l00102"></a>00102     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a> = NULL;
<a name="l00103"></a>00103     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a> = NULL;
<a name="l00104"></a>00104     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a> = NULL;
<a name="l00105"></a>00105     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a> = NULL;
<a name="l00106"></a>00106     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a> = NULL;
<a name="l00107"></a>00107     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a946bf6fc849e9554b489e5fff58be513">sndNxtVector</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afe2cc9a34e2074f95626e4085236d561">sndAckVector</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#acb4230bb789e0bf3e413479e26316d60">rcvSeqVector</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7b6c1fcdd10a035c035dea350420286d">rcvAckVector</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a> = NULL;
<a name="l00108"></a>00108 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0b79ac9c31e99766954c9cca733a362d"></a><!-- doxytag: member="tcp_old::TCPConnection::~TCPConnection" ref="a0b79ac9c31e99766954c9cca733a362d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::~TCPConnection </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Destructor. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00164"></a>00164 {
<a name="l00165"></a>00165     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>;
<a name="l00166"></a>00166     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>;
<a name="l00167"></a>00167     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>;
<a name="l00168"></a>00168     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>)   <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>);
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>) <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>);
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>)  <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>);
<a name="l00173"></a>00173     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>) <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="comment">// statistics</span>
<a name="l00176"></a>00176     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a>;
<a name="l00177"></a>00177     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a946bf6fc849e9554b489e5fff58be513">sndNxtVector</a>;
<a name="l00178"></a>00178     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afe2cc9a34e2074f95626e4085236d561">sndAckVector</a>;
<a name="l00179"></a>00179     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#acb4230bb789e0bf3e413479e26316d60">rcvSeqVector</a>;
<a name="l00180"></a>00180     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7b6c1fcdd10a035c035dea350420286d">rcvAckVector</a>;
<a name="l00181"></a>00181     <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>;
<a name="l00182"></a>00182 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad06a2b75a619021592db07ab486f0fed"></a><!-- doxytag: member="tcp_old::TCPConnection::cancelEvent" ref="ad06a2b75a619021592db07ab486f0fed" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* tcp_old::TCPConnection::cancelEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: cancel a timer </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01115">startSynRexmitTimer()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00449">stateEntered()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00425"></a>00425 {<span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;cancelEvent(msg);}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d5624dcbc77e79d142f6a886b3e788d"></a><!-- doxytag: member="tcp_old::TCPConnection::cloneListeningConnection" ref="a1d5624dcbc77e79d142f6a886b3e788d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_connection.html">TCPConnection</a> * TCPConnection::cloneListeningConnection </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: clone a listening connection. Used for forking. </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00139"></a>00139 {
<a name="l00140"></a>00140     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html">TCPConnection</a> *conn = <span class="keyword">new</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>,<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">appGateIndex</a>,<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <span class="comment">// following code to be kept consistent with initConnection()</span>
<a name="l00143"></a>00143     <span class="keyword">const</span> <span class="keywordtype">char</span> *sendQueueClass = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;getClassName();
<a name="l00144"></a>00144     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a> = check_and_cast&lt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html">TCPSendQueue</a> *&gt;(createOne(sendQueueClass));
<a name="l00145"></a>00145     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#a6580be23b72c3b6afd33532555cc165a">setConnection</a>(conn);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="keyword">const</span> <span class="keywordtype">char</span> *receiveQueueClass = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;getClassName();
<a name="l00148"></a>00148     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a> = check_and_cast&lt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&gt;(createOne(receiveQueueClass));
<a name="l00149"></a>00149     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#ad9e22f581f6cc50d43611b5bc723638c">setConnection</a>(conn);
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     <span class="keyword">const</span> <span class="keywordtype">char</span> *tcpAlgorithmClass = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;getClassName();
<a name="l00152"></a>00152     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a> = check_and_cast&lt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html">TCPAlgorithm</a> *&gt;(createOne(tcpAlgorithmClass));
<a name="l00153"></a>00153     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a2b019306b6e6a3984bd2c81b2713c3f4">setConnection</a>(conn);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a> = conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#aa1d2b17e15a2c8f339174cf5fd70fc0d">getStateVariables</a>();
<a name="l00156"></a>00156     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a>();
<a name="l00157"></a>00157     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#adbd27ed1bccde3db4924db7393ef60ee">initialize</a>();
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="comment">// put it into LISTEN, with our localAddr/localPort</span>
<a name="l00160"></a>00160     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#afba4a9f34c546c37533eb5311c1da682">active</a> = <span class="keyword">false</span>;
<a name="l00161"></a>00161     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4f418e2320cca13bdf3a673ae74989ac">fork</a> = <span class="keyword">true</span>;
<a name="l00162"></a>00162     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>;
<a name="l00163"></a>00163     conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>;
<a name="l00164"></a>00164     FSM_Goto(conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="keywordflow">return</span> conn;
<a name="l00167"></a>00167 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8ddd3d422b9d6e00ad15cf99f9870ef4"></a><!-- doxytag: member="tcp_old::TCPConnection::configureStateVariables" ref="a8ddd3d422b9d6e00ad15cf99f9870ef4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::configureStateVariables </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: set snd_mss and rcv_wnd in newly created state variables block </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00283">initConnection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00312"></a>00312 {
<a name="l00313"></a>00313     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;mss&quot;</span>).longValue(); <span class="comment">// TODO: mss=-1 should mean autodetect</span>
<a name="l00314"></a>00314     <span class="keywordtype">long</span> advertisedWindowPar = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;advertisedWindow&quot;</span>).longValue();
<a name="l00315"></a>00315     <span class="keywordflow">if</span> (advertisedWindowPar &gt; <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a> || advertisedWindowPar &lt;= 0)
<a name="l00316"></a>00316         <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;Invalid advertisedWindow parameter: %d&quot;</span>, advertisedWindowPar);
<a name="l00317"></a>00317     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ab26a1e5c5f13a245ef7578dc87e81cfe">rcv_wnd</a> = advertisedWindowPar;
<a name="l00318"></a>00318 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a462206e0bc50ae521a47a797552a0057"></a><!-- doxytag: member="tcp_old::TCPConnection::createTCPSegment" ref="a462206e0bc50ae521a47a797552a0057" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> * TCPConnection::createTCPSegment </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: This factory method gets invoked throughout the <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> model to create a <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>. Override it if you need to subclass <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>. </p>

<p>Referenced by <a class="el" href="old_2queues_2_t_c_p_virtual_data_send_queue_8cc_source.html#l00064">tcp_old::TCPVirtualDataSendQueue::createSegmentWithBytes()</a>, <a class="el" href="old_2queues_2_t_c_p_msg_based_send_queue_8cc_source.html#l00070">tcp_old::TCPMsgBasedSendQueue::createSegmentWithBytes()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00414">sendAck()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00430">sendFin()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00381">sendRst()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00395">sendRstAck()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00338">sendSyn()</a>, and <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00357">sendSynAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00241"></a>00241 {
<a name="l00242"></a>00242     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>(name);
<a name="l00243"></a>00243 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af199cd53f71f27341684145c3bdab306"></a><!-- doxytag: member="tcp_old::TCPConnection::eventName" ref="af199cd53f71f27341684145c3bdab306" args="(int event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::eventName </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>event</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_E_xxx constants </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00284">performStateTransition()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00061"></a>00061 {
<a name="l00062"></a>00062 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00064"></a>00064     <span class="keywordflow">switch</span> (event)
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>);
<a name="l00067"></a>00067         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6179df5a4a1f3314be52f5789f5f0bb6">TCP_E_OPEN_ACTIVE</a>);
<a name="l00068"></a>00068         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a11dd6ccbd9b9bbb145b64fb99981b530">TCP_E_OPEN_PASSIVE</a>);
<a name="l00069"></a>00069         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32af5e9f1961ac4c76e49f568d8fd304063">TCP_E_SEND</a>);
<a name="l00070"></a>00070         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>);
<a name="l00071"></a>00071         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>);
<a name="l00072"></a>00072         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32adea9b33ab4047345817fb7d8066a8ae2">TCP_E_STATUS</a>);
<a name="l00073"></a>00073         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1e5b9fcdbbaae24327c007914ad57a7f">TCP_E_RCV_DATA</a>);
<a name="l00074"></a>00074         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>);
<a name="l00075"></a>00075         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6769520e2e41d511462d3608d18326ed">TCP_E_RCV_SYN</a>);
<a name="l00076"></a>00076         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a3239eea5ba6edf6850289914cfac51c8">TCP_E_RCV_SYN_ACK</a>);
<a name="l00077"></a>00077         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a59323c4bb3247640d61362e7f6ba824e">TCP_E_RCV_FIN</a>);
<a name="l00078"></a>00078         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2f4afa3cc8122b708143ae335b542179">TCP_E_RCV_FIN_ACK</a>);
<a name="l00079"></a>00079         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>);
<a name="l00080"></a>00080         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>);
<a name="l00081"></a>00081         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a358c0a11572a1131e318543e4b64764a">TCP_E_TIMEOUT_2MSL</a>);
<a name="l00082"></a>00082         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6ba25d81f0bcad8dbc3f1f59ce2f08ed">TCP_E_TIMEOUT_CONN_ESTAB</a>);
<a name="l00083"></a>00083         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a3d31d30a7eca2a0655da0b2c16df9500">TCP_E_TIMEOUT_FIN_WAIT_2</a>);
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085     <span class="keywordflow">return</span> s;
<a name="l00086"></a>00086 <span class="preprocessor">#undef CASE</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55abadf8c9f66428b7f6db8fa90d1af3"></a><!-- doxytag: member="tcp_old::TCPConnection::getFsmState" ref="a55abadf8c9f66428b7f6db8fa90d1af3" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcp_old::TCPConnection::getFsmState </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00478"></a>00478 {<span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState();}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab9c0058b4df0583d36fd462e71c3120d"></a><!-- doxytag: member="tcp_old::TCPConnection::getReceiveQueue" ref="ab9c0058b4df0583d36fd462e71c3120d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_receive_queue.html">TCPReceiveQueue</a>* tcp_old::TCPConnection::getReceiveQueue </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00481"></a>00481 {<span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a15a684dc0613b455e92c0ae57a00f177"></a><!-- doxytag: member="tcp_old::TCPConnection::getSendQueue" ref="a15a684dc0613b455e92c0ae57a00f177" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_send_queue.html">TCPSendQueue</a>* tcp_old::TCPConnection::getSendQueue </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00480"></a>00480 {<span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1704500b72eb201d9119192ebb9b4923"></a><!-- doxytag: member="tcp_old::TCPConnection::getState" ref="a1704500b72eb201d9119192ebb9b4923" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_state_variables.html">TCPStateVariables</a>* tcp_old::TCPConnection::getState </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00479"></a>00479 {<span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11c0933a5657daacb6cbc27de282187f"></a><!-- doxytag: member="tcp_old::TCPConnection::getTcpAlgorithm" ref="a11c0933a5657daacb6cbc27de282187f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_algorithm.html">TCPAlgorithm</a>* tcp_old::TCPConnection::getTcpAlgorithm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00482"></a>00482 {<span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ba299a7999e64fe67e8fef5f62c2402"></a><!-- doxytag: member="tcp_old::TCPConnection::getTcpMain" ref="a5ba299a7999e64fe67e8fef5f62c2402" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a>* tcp_old::TCPConnection::getTcpMain </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00061">tcp_old::DumbTCP::connectionClosed()</a>, <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00117">tcp_old::DumbTCP::dataSent()</a>, <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00116">tcp_old::TCPBaseAlg::initialize()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00114">TCPConnection()</a>, and <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00035">tcp_old::DumbTCP::~DumbTCP()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00483"></a>00483 {<span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="adeef1c0b8f04a744168a107f68c397ba"></a><!-- doxytag: member="tcp_old::TCPConnection::indicationName" ref="adeef1c0b8f04a744168a107f68c397ba" args="(int code)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::indicationName </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>code</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_I_xxx constants </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00261">sendEstabIndicationToApp()</a>, and <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00250">sendIndicationToApp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00090"></a>00090 {
<a name="l00091"></a>00091 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00093"></a>00093     <span class="keywordflow">switch</span> (code)
<a name="l00094"></a>00094     {
<a name="l00095"></a>00095         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba78bce3d41e158816c5212ed2fc959b06">TCP_I_DATA</a>);
<a name="l00096"></a>00096         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba9b994384633a16021eef2cbb604d6ac7">TCP_I_URGENT_DATA</a>);
<a name="l00097"></a>00097         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba778d635f284e560631e2b6ce594e3323">TCP_I_ESTABLISHED</a>);
<a name="l00098"></a>00098         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba98ff9f82c08b1d7ae58049835c47368a">TCP_I_PEER_CLOSED</a>);
<a name="l00099"></a>00099         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00100"></a>00100         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba21824d5a95e3b86c41f35775bb5f23ab">TCP_I_CONNECTION_REFUSED</a>);
<a name="l00101"></a>00101         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba4e8f4551a34a27e607201754b36fdbe0">TCP_I_CONNECTION_RESET</a>);
<a name="l00102"></a>00102         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba06629e44a0aef5201b4cd424596127bf">TCP_I_TIMED_OUT</a>);
<a name="l00103"></a>00103         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956babe4b456d5340a1c5d9ed0b0384409159">TCP_I_STATUS</a>);
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105     <span class="keywordflow">return</span> s;
<a name="l00106"></a>00106 <span class="preprocessor">#undef CASE</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a69caa8ea0ffbe8d9f73f935aac1b29d9"></a><!-- doxytag: member="tcp_old::TCPConnection::initConnection" ref="a69caa8ea0ffbe8d9f73f935aac1b29d9" args="(TCPOpenCommand *openCmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::initConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>openCmd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: creates send/receive queues and tcpAlgorithm </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, and <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00080">process_OPEN_PASSIVE()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00284"></a>00284 {
<a name="l00285"></a>00285     <span class="comment">// create send/receive queues</span>
<a name="l00286"></a>00286     <span class="keyword">const</span> <span class="keywordtype">char</span> *sendQueueClass = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#ac93aa56190dd09b5a957043766a057b7">getSendQueueClass</a>();
<a name="l00287"></a>00287     <span class="keywordflow">if</span> (!sendQueueClass || !sendQueueClass[0])
<a name="l00288"></a>00288         sendQueueClass = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;sendQueueClass&quot;</span>);
<a name="l00289"></a>00289     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a> = check_and_cast&lt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html">TCPSendQueue</a> *&gt;(createOne(sendQueueClass));
<a name="l00290"></a>00290     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#a6580be23b72c3b6afd33532555cc165a">setConnection</a>(<span class="keyword">this</span>);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="keyword">const</span> <span class="keywordtype">char</span> *receiveQueueClass = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#af13ad188ff7db724d703a097cd5827f2">getReceiveQueueClass</a>();
<a name="l00293"></a>00293     <span class="keywordflow">if</span> (!receiveQueueClass || !receiveQueueClass[0])
<a name="l00294"></a>00294         receiveQueueClass = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;receiveQueueClass&quot;</span>);
<a name="l00295"></a>00295     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a> = check_and_cast&lt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&gt;(createOne(receiveQueueClass));
<a name="l00296"></a>00296     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#ad9e22f581f6cc50d43611b5bc723638c">setConnection</a>(<span class="keyword">this</span>);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <span class="comment">// create algorithm</span>
<a name="l00299"></a>00299     <span class="keyword">const</span> <span class="keywordtype">char</span> *tcpAlgorithmClass = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a6405afe94b3bd1915952553a1117e819">getTcpAlgorithmClass</a>();
<a name="l00300"></a>00300     <span class="keywordflow">if</span> (!tcpAlgorithmClass || !tcpAlgorithmClass[0])
<a name="l00301"></a>00301         tcpAlgorithmClass = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;tcpAlgorithmClass&quot;</span>);
<a name="l00302"></a>00302     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a> = check_and_cast&lt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html">TCPAlgorithm</a> *&gt;(createOne(tcpAlgorithmClass));
<a name="l00303"></a>00303     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a2b019306b6e6a3984bd2c81b2713c3f4">setConnection</a>(<span class="keyword">this</span>);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="comment">// create state block</span>
<a name="l00306"></a>00306     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#aa1d2b17e15a2c8f339174cf5fd70fc0d">getStateVariables</a>();
<a name="l00307"></a>00307     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a>();
<a name="l00308"></a>00308     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#adbd27ed1bccde3db4924db7393ef60ee">initialize</a>();
<a name="l00309"></a>00309 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acceb561b23349d06b298858e39433435"></a><!-- doxytag: member="tcp_old::TCPConnection::isSegmentAcceptable" ref="acceb561b23349d06b298858e39433435" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::isSegmentAcceptable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: check if segment is acceptable (all bytes are in receive window) </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00331"></a>00331 {
<a name="l00332"></a>00332     <span class="comment">// check that segment entirely falls in receive window</span>
<a name="l00333"></a>00333     <span class="comment">//FIXME probably not this simple, see old code segAccept() below...</span>
<a name="l00334"></a>00334     <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#a0012c6f2a0631480574729efd85a05c9">seqGE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>(),<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>) &amp;&amp;
<a name="l00335"></a>00335            <a class="code" href="namespacetcp__old.html#a2a4d76c437a6e0eb1e1440c02153e5db">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()+tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>(),<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>+<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ab26a1e5c5f13a245ef7578dc87e81cfe">rcv_wnd</a>);
<a name="l00336"></a>00336 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa1fe5fa359d4063c984d686e4166b798"></a><!-- doxytag: member="tcp_old::TCPConnection::performStateTransition" ref="aa1fe5fa359d4063c984d686e4166b798" args="(const TCPEventCode &amp;event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::performStateTransition </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Implemements the pure <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> state machine </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00221">processTCPSegment()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00285"></a>00285 {
<a name="l00286"></a>00286     ASSERT(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()!=<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="comment">// closed connections should be deleted immediately</span>
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <span class="keywordflow">if</span> (event==<a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>)  <span class="comment">// e.g. discarded segment</span>
<a name="l00289"></a>00289     {
<a name="l00290"></a>00290         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Staying in state: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; (no FSM event)\n&quot;</span>;
<a name="l00291"></a>00291         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00292"></a>00292     }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="comment">// state machine</span>
<a name="l00295"></a>00295     <span class="comment">// TBD add handling of connection timeout event (keepalive), with transition to CLOSED</span>
<a name="l00296"></a>00296     <span class="comment">// Note: empty &quot;default:&quot; lines are for gcc&#39;s benefit which would otherwise spit warnings</span>
<a name="l00297"></a>00297     <span class="keywordtype">int</span> oldState = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState();
<a name="l00298"></a>00298     <span class="keywordflow">switch</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00299"></a>00299     {
<a name="l00300"></a>00300         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>:
<a name="l00301"></a>00301             <span class="keywordflow">switch</span> (event)
<a name="l00302"></a>00302             {
<a name="l00303"></a>00303                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a11dd6ccbd9b9bbb145b64fb99981b530">TCP_E_OPEN_PASSIVE</a>:FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
<a name="l00304"></a>00304                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6179df5a4a1f3314be52f5789f5f0bb6">TCP_E_OPEN_ACTIVE</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
<a name="l00305"></a>00305                 <span class="keywordflow">default</span>:;
<a name="l00306"></a>00306             }
<a name="l00307"></a>00307             <span class="keywordflow">break</span>;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>:
<a name="l00310"></a>00310             <span class="keywordflow">switch</span> (event)
<a name="l00311"></a>00311             {
<a name="l00312"></a>00312                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6179df5a4a1f3314be52f5789f5f0bb6">TCP_E_OPEN_ACTIVE</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
<a name="l00313"></a>00313                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32af5e9f1961ac4c76e49f568d8fd304063">TCP_E_SEND</a>:        FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
<a name="l00314"></a>00314                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00315"></a>00315                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00316"></a>00316                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6769520e2e41d511462d3608d18326ed">TCP_E_RCV_SYN</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>);<span class="keywordflow">break</span>;
<a name="l00317"></a>00317                 <span class="keywordflow">default</span>:;
<a name="l00318"></a>00318             }
<a name="l00319"></a>00319             <span class="keywordflow">break</span>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>:
<a name="l00322"></a>00322             <span class="keywordflow">switch</span> (event)
<a name="l00323"></a>00323             {
<a name="l00324"></a>00324                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>); <span class="keywordflow">break</span>;
<a name="l00325"></a>00325                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00326"></a>00326                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6ba25d81f0bcad8dbc3f1f59ce2f08ed">TCP_E_TIMEOUT_CONN_ESTAB</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#afba4a9f34c546c37533eb5311c1da682">active</a> ? <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a> : <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
<a name="l00327"></a>00327                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#afba4a9f34c546c37533eb5311c1da682">active</a> ? <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a> : <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
<a name="l00328"></a>00328                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>); <span class="keywordflow">break</span>;
<a name="l00329"></a>00329                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a59323c4bb3247640d61362e7f6ba824e">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00330"></a>00330                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00331"></a>00331                 <span class="keywordflow">default</span>:;
<a name="l00332"></a>00332             }
<a name="l00333"></a>00333             <span class="keywordflow">break</span>;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>:
<a name="l00336"></a>00336             <span class="keywordflow">switch</span> (event)
<a name="l00337"></a>00337             {
<a name="l00338"></a>00338                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00339"></a>00339                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00340"></a>00340                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6ba25d81f0bcad8dbc3f1f59ce2f08ed">TCP_E_TIMEOUT_CONN_ESTAB</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00341"></a>00341                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00342"></a>00342                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a3239eea5ba6edf6850289914cfac51c8">TCP_E_RCV_SYN_ACK</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>); <span class="keywordflow">break</span>;
<a name="l00343"></a>00343                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6769520e2e41d511462d3608d18326ed">TCP_E_RCV_SYN</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>); <span class="keywordflow">break</span>;
<a name="l00344"></a>00344                 <span class="keywordflow">default</span>:;
<a name="l00345"></a>00345             }
<a name="l00346"></a>00346             <span class="keywordflow">break</span>;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>:
<a name="l00349"></a>00349             <span class="keywordflow">switch</span> (event)
<a name="l00350"></a>00350             {
<a name="l00351"></a>00351                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>); <span class="keywordflow">break</span>;
<a name="l00352"></a>00352                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00353"></a>00353                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a59323c4bb3247640d61362e7f6ba824e">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00354"></a>00354                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00355"></a>00355                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00356"></a>00356                 <span class="keywordflow">default</span>:;
<a name="l00357"></a>00357             }
<a name="l00358"></a>00358             <span class="keywordflow">break</span>;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>:
<a name="l00361"></a>00361             <span class="keywordflow">switch</span> (event)
<a name="l00362"></a>00362             {
<a name="l00363"></a>00363                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>); <span class="keywordflow">break</span>;
<a name="l00364"></a>00364                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00365"></a>00365                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00366"></a>00366                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00367"></a>00367                 <span class="keywordflow">default</span>:;
<a name="l00368"></a>00368             }
<a name="l00369"></a>00369             <span class="keywordflow">break</span>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>:
<a name="l00372"></a>00372             <span class="keywordflow">switch</span> (event)
<a name="l00373"></a>00373             {
<a name="l00374"></a>00374                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00375"></a>00375                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00376"></a>00376                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00377"></a>00377                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00378"></a>00378                 <span class="keywordflow">default</span>:;
<a name="l00379"></a>00379             }
<a name="l00380"></a>00380             <span class="keywordflow">break</span>;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>:
<a name="l00383"></a>00383             <span class="keywordflow">switch</span> (event)
<a name="l00384"></a>00384             {
<a name="l00385"></a>00385                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00386"></a>00386                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a59323c4bb3247640d61362e7f6ba824e">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a>); <span class="keywordflow">break</span>;
<a name="l00387"></a>00387                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>); <span class="keywordflow">break</span>;
<a name="l00388"></a>00388                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2f4afa3cc8122b708143ae335b542179">TCP_E_RCV_FIN_ACK</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00389"></a>00389                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00390"></a>00390                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00391"></a>00391                 <span class="keywordflow">default</span>:;
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393             <span class="keywordflow">break</span>;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l00396"></a>00396             <span class="keywordflow">switch</span> (event)
<a name="l00397"></a>00397             {
<a name="l00398"></a>00398                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00399"></a>00399                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a59323c4bb3247640d61362e7f6ba824e">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00400"></a>00400                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a3d31d30a7eca2a0655da0b2c16df9500">TCP_E_TIMEOUT_FIN_WAIT_2</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00401"></a>00401                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00402"></a>00402                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00403"></a>00403                 <span class="keywordflow">default</span>:;
<a name="l00404"></a>00404             }
<a name="l00405"></a>00405             <span class="keywordflow">break</span>;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a>:
<a name="l00408"></a>00408             <span class="keywordflow">switch</span> (event)
<a name="l00409"></a>00409             {
<a name="l00410"></a>00410                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00411"></a>00411                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00412"></a>00412                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00413"></a>00413                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00414"></a>00414                 <span class="keywordflow">default</span>:;
<a name="l00415"></a>00415             }
<a name="l00416"></a>00416             <span class="keywordflow">break</span>;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>:
<a name="l00419"></a>00419             <span class="keywordflow">switch</span> (event)
<a name="l00420"></a>00420             {
<a name="l00421"></a>00421                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00422"></a>00422                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a358c0a11572a1131e318543e4b64764a">TCP_E_TIMEOUT_2MSL</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00423"></a>00423                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00424"></a>00424                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>, <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00425"></a>00425                 <span class="keywordflow">default</span>:;
<a name="l00426"></a>00426             }
<a name="l00427"></a>00427             <span class="keywordflow">break</span>;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>:
<a name="l00430"></a>00430             <span class="keywordflow">break</span>;
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     <span class="keywordflow">if</span> (oldState!=<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00434"></a>00434     {
<a name="l00435"></a>00435         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Transition: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(oldState) &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot;  (event was: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00436"></a>00436         <a class="code" href="_t_c_p_8h.html#a85ddacbb6727d1260826a130068eef15">testingEV</a> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(oldState) &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot;  (on &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <span class="comment">// cancel timers, etc.</span>
<a name="l00439"></a>00439         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState());
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441     <span class="keywordflow">else</span>
<a name="l00442"></a>00442     {
<a name="l00443"></a>00443         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Staying in state: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; (event was: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()!=<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>;
<a name="l00447"></a>00447 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a792d9159b4e64b344cac79d0716c907a"></a><!-- doxytag: member="tcp_old::TCPConnection::preanalyseAppCommandEvent" ref="a792d9159b4e64b344cac79d0716c907a" args="(int commandCode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> TCPConnection::preanalyseAppCommandEvent </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>commandCode</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Maps app command codes (msg kind of app command msgs) to TCP_E_xxx event codes </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00270"></a>00270 {
<a name="l00271"></a>00271     <span class="keywordflow">switch</span> (commandCode)
<a name="l00272"></a>00272     {
<a name="l00273"></a>00273         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a9cf8b93f6f9a392ec92dc8c0735d0099">TCP_C_OPEN_ACTIVE</a>:  <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6179df5a4a1f3314be52f5789f5f0bb6">TCP_E_OPEN_ACTIVE</a>;
<a name="l00274"></a>00274         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a973f05e12deb1f283795b6eedc476cb8">TCP_C_OPEN_PASSIVE</a>: <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a11dd6ccbd9b9bbb145b64fb99981b530">TCP_E_OPEN_PASSIVE</a>;
<a name="l00275"></a>00275         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a5551d7ad54c2f8afd61355444ec620a6">TCP_C_SEND</a>:         <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32af5e9f1961ac4c76e49f568d8fd304063">TCP_E_SEND</a>;
<a name="l00276"></a>00276         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6aa18cb807579ad3b72293d3023883ba0a">TCP_C_CLOSE</a>:        <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>;
<a name="l00277"></a>00277         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a50eccd3eb23bdd7758a5e67a5e36c533">TCP_C_ABORT</a>:        <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>;
<a name="l00278"></a>00278         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a77c74858a4d11f1ac6bcfc26e20a44e2">TCP_C_STATUS</a>:       <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32adea9b33ab4047345817fb7d8066a8ae2">TCP_E_STATUS</a>;
<a name="l00279"></a>00279         <span class="keywordflow">default</span>: opp_error(<span class="stringliteral">&quot;Unknown message kind in app command&quot;</span>);
<a name="l00280"></a>00280                  <span class="keywordflow">return</span> (<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>)0; <span class="comment">// to satisfy compiler</span>
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8aaec47dd8098dbaa015f2e3e7b16442"></a><!-- doxytag: member="tcp_old::TCPConnection::printConnBrief" ref="a8aaec47dd8098dbaa015f2e3e7b16442" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::printConnBrief </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: prints local/remote addr/port and app gate index/connId </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00221">processTCPSegment()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00110"></a>00110 {
<a name="l00111"></a>00111     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Connection &quot;</span>;
<a name="l00112"></a>00112     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a>;
<a name="l00113"></a>00113     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  on app[&quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">appGateIndex</a> &lt;&lt; <span class="stringliteral">&quot;],connId=&quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a>;
<a name="l00114"></a>00114     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  in &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState());
<a name="l00115"></a>00115     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  (ptr=0x&quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00116"></a>00116 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a188549e7c936c8cad622c180d3200c69"></a><!-- doxytag: member="tcp_old::TCPConnection::printSegmentBrief" ref="a188549e7c936c8cad622c180d3200c69" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::printSegmentBrief </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: prints important header fields </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00037">segmentArrivalWhileClosed()</a>, and <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00169">sendToIP()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00119"></a>00119 {
<a name="l00120"></a>00120     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>() &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span>;
<a name="l00121"></a>00121     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>() ? <span class="stringliteral">&quot;SYN+ACK &quot;</span> : <span class="stringliteral">&quot;SYN &quot;</span>);
<a name="l00124"></a>00124     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN(+ACK) &quot;</span>;
<a name="l00125"></a>00125     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>() ? <span class="stringliteral">&quot;RST+ACK &quot;</span> : <span class="stringliteral">&quot;RST &quot;</span>);
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a951517b397bea146bb642976521469d7">getPshBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;PSH &quot;</span>;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0 || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00129"></a>00129     {
<a name="l00130"></a>00130         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()+tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00131"></a>00131         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ack &quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00134"></a>00134     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;win &quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;urg &quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a03ba1de6fcc042310e77da13885ce0d0">getUrgentPointer</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00136"></a>00136 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afb2189f1428627dcde1d1b0bfbc50833"></a><!-- doxytag: member="tcp_old::TCPConnection::process_ABORT" ref="afb2189f1428627dcde1d1b0bfbc50833" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_ABORT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00223"></a>00223 {
<a name="l00224"></a>00224     <span class="keyword">delete</span> tcpCommand;
<a name="l00225"></a>00225     <span class="keyword">delete</span> msg;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">//</span>
<a name="l00228"></a>00228     <span class="comment">// The ABORT event will automatically take the connection to the CLOSED</span>
<a name="l00229"></a>00229     <span class="comment">// state, flush queues etc -- no need to do it here. Also, we don&#39;t need to</span>
<a name="l00230"></a>00230     <span class="comment">// send notification to the user, they know what&#39;s going on.</span>
<a name="l00231"></a>00231     <span class="comment">//</span>
<a name="l00232"></a>00232     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00233"></a>00233     {
<a name="l00234"></a>00234         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>:
<a name="l00235"></a>00235             opp_error(<span class="stringliteral">&quot;Error processing command ABORT: connection not open&quot;</span>);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>:
<a name="l00238"></a>00238         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>:
<a name="l00239"></a>00239         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>:
<a name="l00240"></a>00240         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l00241"></a>00241         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>:
<a name="l00242"></a>00242             <span class="comment">//&quot;</span>
<a name="l00243"></a>00243             <span class="comment">// Send a reset segment:</span>
<a name="l00244"></a>00244             <span class="comment">//</span>
<a name="l00245"></a>00245             <span class="comment">//   &lt;SEQ=SND.NXT&gt;&lt;CTL=RST&gt;</span>
<a name="l00246"></a>00246             <span class="comment">//&quot;</span>
<a name="l00247"></a>00247             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>);
<a name="l00248"></a>00248             <span class="keywordflow">break</span>;
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5aa9b20651a4c1f90772a7c02eacbf05"></a><!-- doxytag: member="tcp_old::TCPConnection::process_CLOSE" ref="a5aa9b20651a4c1f90772a7c02eacbf05" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_CLOSE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00162"></a>00162 {
<a name="l00163"></a>00163     <span class="keyword">delete</span> tcpCommand;
<a name="l00164"></a>00164     <span class="keyword">delete</span> msg;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00167"></a>00167     {
<a name="l00168"></a>00168         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>:
<a name="l00169"></a>00169             opp_error(<span class="stringliteral">&quot;Error processing command CLOSE: connection not open&quot;</span>);
<a name="l00170"></a>00170 
<a name="l00171"></a>00171         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>:
<a name="l00172"></a>00172             <span class="comment">// Nothing to do here</span>
<a name="l00173"></a>00173             <span class="keywordflow">break</span>;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>:
<a name="l00176"></a>00176             <span class="comment">// Delete the TCB and return &quot;error:  closing&quot; responses to any</span>
<a name="l00177"></a>00177             <span class="comment">// queued SENDs, or RECEIVEs.</span>
<a name="l00178"></a>00178             <span class="keywordflow">break</span>;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>:
<a name="l00181"></a>00181         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>:
<a name="l00182"></a>00182         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>:
<a name="l00183"></a>00183             <span class="comment">//</span>
<a name="l00184"></a>00184             <span class="comment">// SYN_RCVD processing (ESTABLISHED and CLOSE_WAIT are similar):</span>
<a name="l00185"></a>00185             <span class="comment">//&quot;</span>
<a name="l00186"></a>00186             <span class="comment">// If no SENDs have been issued and there is no pending data to send,</span>
<a name="l00187"></a>00187             <span class="comment">// then form a FIN segment and send it, and enter FIN-WAIT-1 state;</span>
<a name="l00188"></a>00188             <span class="comment">// otherwise queue for processing after entering ESTABLISHED state.</span>
<a name="l00189"></a>00189             <span class="comment">//&quot;</span>
<a name="l00190"></a>00190             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#addf53d15d095b683486ca61554dccae3">getBufferEndSeq</a>())
<a name="l00191"></a>00191             {
<a name="l00192"></a>00192                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;No outstanding SENDs, sending FIN right away, advancing snd_nxt over the FIN\n&quot;</span>;
<a name="l00193"></a>00193                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>;
<a name="l00194"></a>00194                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin</a>();
<a name="l00195"></a>00195                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#aceb0701fa06010324266e6a8192cce9f">restartRexmitTimer</a>();
<a name="l00196"></a>00196                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> = ++<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>;
<a name="l00197"></a>00197                 <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>-&gt;record(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> - <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199                 <span class="comment">// state transition will automatically take us to FIN_WAIT_1 (or LAST_ACK)</span>
<a name="l00200"></a>00200             }
<a name="l00201"></a>00201             <span class="keywordflow">else</span>
<a name="l00202"></a>00202             {
<a name="l00203"></a>00203                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SEND of &quot;</span> &lt;&lt; (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#addf53d15d095b683486ca61554dccae3">getBufferEndSeq</a>()-<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>) &lt;&lt;
<a name="l00204"></a>00204                       <span class="stringliteral">&quot; bytes pending, deferring sending of FIN\n&quot;</span>;
<a name="l00205"></a>00205                 <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00206"></a>00206             }
<a name="l00207"></a>00207             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a2a8d544b5707071afcc5402e6318e245">send_fin</a> = <span class="keyword">true</span>;
<a name="l00208"></a>00208             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a1156c4cdd71d0e83c9bb401a68e9f606">snd_fin_seq</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#addf53d15d095b683486ca61554dccae3">getBufferEndSeq</a>();
<a name="l00209"></a>00209             <span class="keywordflow">break</span>;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>:
<a name="l00212"></a>00212         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l00213"></a>00213         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a>:
<a name="l00214"></a>00214         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>:
<a name="l00215"></a>00215         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>:
<a name="l00216"></a>00216             <span class="comment">// RFC 793 is not entirely clear on how to handle a duplicate close request.</span>
<a name="l00217"></a>00217             <span class="comment">// Here we treat it as an error.</span>
<a name="l00218"></a>00218             opp_error(<span class="stringliteral">&quot;Duplicate CLOSE command: connection already closing&quot;</span>);
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6ef625498d593ac11744aa92a404e06d"></a><!-- doxytag: member="tcp_old::TCPConnection::process_OPEN_ACTIVE" ref="a6ef625498d593ac11744aa92a404e06d" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_OPEN_ACTIVE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00035"></a>00035 {
<a name="l00036"></a>00036     <a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd = check_and_cast&lt;<a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *&gt;(tcpCommand);
<a name="l00037"></a>00037     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>;
<a name="l00038"></a>00038     <span class="keywordtype">int</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a>;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00041"></a>00041     {
<a name="l00042"></a>00042         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>:
<a name="l00043"></a>00043             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a>(openCmd);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045             <span class="comment">// store local/remote socket</span>
<a name="l00046"></a>00046             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#afba4a9f34c546c37533eb5311c1da682">active</a> = <span class="keyword">true</span>;
<a name="l00047"></a>00047             localAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a8df2394c15fc7fb872491275d9db03b4">getLocalAddr</a>();
<a name="l00048"></a>00048             remoteAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a9e602467cc21c7c3a2ea9aae64f1319e">getRemoteAddr</a>();
<a name="l00049"></a>00049             localPort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a8d1ced9e8f5355c77266673e7a2fc35f">getLocalPort</a>();
<a name="l00050"></a>00050             remotePort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a4d1170bbd04519d8b8f37677ba512f35">getRemotePort</a>();
<a name="l00051"></a>00051 
<a name="l00052"></a>00052             <span class="keywordflow">if</span> (remoteAddr.isUnspecified() || remotePort==-1)
<a name="l00053"></a>00053                 opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: remote address and port must be specified&quot;</span>);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055             <span class="keywordflow">if</span> (localPort==-1)
<a name="l00056"></a>00056             {
<a name="l00057"></a>00057                 localPort = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p.html#af6a465c04eb9301ac7627d6922564e72">getEphemeralPort</a>();
<a name="l00058"></a>00058                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Assigned ephemeral port &quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00059"></a>00059             }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;OPEN: &quot;</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; remoteAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; remotePort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">addSockPair</a>(<span class="keyword">this</span>, localAddr, remoteAddr, localPort, remotePort);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065             <span class="comment">// send initial SYN</span>
<a name="l00066"></a>00066             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();
<a name="l00067"></a>00067             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>();
<a name="l00068"></a>00068             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
<a name="l00069"></a>00069             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);
<a name="l00070"></a>00070             <span class="keywordflow">break</span>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="keywordflow">default</span>:
<a name="l00073"></a>00073             opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: connection already exists&quot;</span>);
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     <span class="keyword">delete</span> openCmd;
<a name="l00077"></a>00077     <span class="keyword">delete</span> msg;
<a name="l00078"></a>00078 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a26e4a86dfbc1efaf02e99ea14d410ae3"></a><!-- doxytag: member="tcp_old::TCPConnection::process_OPEN_PASSIVE" ref="a26e4a86dfbc1efaf02e99ea14d410ae3" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_OPEN_PASSIVE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00081"></a>00081 {
<a name="l00082"></a>00082     <a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd = check_and_cast&lt;<a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *&gt;(tcpCommand);
<a name="l00083"></a>00083     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>;
<a name="l00084"></a>00084     <span class="keywordtype">int</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00087"></a>00087     {
<a name="l00088"></a>00088         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>:
<a name="l00089"></a>00089             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a>(openCmd);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091             <span class="comment">// store local/remote socket</span>
<a name="l00092"></a>00092             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#afba4a9f34c546c37533eb5311c1da682">active</a> = <span class="keyword">false</span>;
<a name="l00093"></a>00093             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4f418e2320cca13bdf3a673ae74989ac">fork</a> = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a719c5eb06ab9b7a819285fd2052aac9c">getFork</a>();
<a name="l00094"></a>00094             localAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a8df2394c15fc7fb872491275d9db03b4">getLocalAddr</a>();
<a name="l00095"></a>00095             localPort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a8d1ced9e8f5355c77266673e7a2fc35f">getLocalPort</a>();
<a name="l00096"></a>00096 
<a name="l00097"></a>00097             <span class="keywordflow">if</span> (localPort==-1)
<a name="l00098"></a>00098                 opp_error(<span class="stringliteral">&quot;Error processing command OPEN_PASSIVE: local port must be specified&quot;</span>);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Starting to listen on: &quot;</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">addSockPair</a>(<span class="keyword">this</span>, localAddr, <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(), localPort, -1);
<a name="l00103"></a>00103             <span class="keywordflow">break</span>;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105         <span class="keywordflow">default</span>:
<a name="l00106"></a>00106             opp_error(<span class="stringliteral">&quot;Error processing command OPEN_PASSIVE: connection already exists&quot;</span>);
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="keyword">delete</span> openCmd;
<a name="l00110"></a>00110     <span class="keyword">delete</span> msg;
<a name="l00111"></a>00111 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a46ac1b09624942471db2eb76ef991143"></a><!-- doxytag: member="tcp_old::TCPConnection::process_RCV_SEGMENT" ref="a46ac1b09624942471db2eb76ef991143" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> TCPConnection::process_RCV_SEGMENT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process incoming <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> segment. Returns a specific event code (e.g. TCP_E_RCV_SYN) which will drive the state machine. </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00221">processTCPSegment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00084"></a>00084 {
<a name="l00085"></a>00085     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Seg arrived: &quot;</span>;
<a name="l00086"></a>00086     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
<a name="l00087"></a>00087     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCB: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a93fbf3558fe0e1dfa27bdbab25c36aff">info</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#acb4230bb789e0bf3e413479e26316d60">rcvSeqVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#acb4230bb789e0bf3e413479e26316d60">rcvSeqVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>());
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7b6c1fcdd10a035c035dea350420286d">rcvAckVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7b6c1fcdd10a035c035dea350420286d">rcvAckVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>());
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="comment">//</span>
<a name="l00093"></a>00093     <span class="comment">// Note: this code is organized exactly as RFC 793, section &quot;3.9 Event</span>
<a name="l00094"></a>00094     <span class="comment">// Processing&quot;, subsection &quot;SEGMENT ARRIVES&quot;.</span>
<a name="l00095"></a>00095     <span class="comment">//</span>
<a name="l00096"></a>00096     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> event;
<a name="l00097"></a>00097     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>)
<a name="l00098"></a>00098     {
<a name="l00099"></a>00099         <span class="keyword">event</span> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen</a>(tcpseg, src, dest);
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>)
<a name="l00102"></a>00102     {
<a name="l00103"></a>00103         <span class="keyword">event</span> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent</a>(tcpseg, src, dest);
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105     <span class="keywordflow">else</span>
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107         <span class="comment">// RFC 793 steps &quot;first check sequence number&quot;, &quot;second check the RST bit&quot;, etc</span>
<a name="l00108"></a>00108         <span class="keyword">event</span> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th</a>(tcpseg);
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110     <span class="keyword">delete</span> tcpseg;
<a name="l00111"></a>00111     <span class="keywordflow">return</span> event;
<a name="l00112"></a>00112 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a65fa8d6570761c63cdab5cef7f5df685"></a><!-- doxytag: member="tcp_old::TCPConnection::process_SEND" ref="a65fa8d6570761c63cdab5cef7f5df685" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_SEND </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00114"></a>00114 {
<a name="l00115"></a>00115     <a class="code" href="class_t_c_p_send_command.html">TCPSendCommand</a> *sendCommand = check_and_cast&lt;<a class="code" href="class_t_c_p_send_command.html">TCPSendCommand</a> *&gt;(tcpCommand);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="comment">// FIXME how to support PUSH? One option is to treat each SEND as a unit of data,</span>
<a name="l00118"></a>00118     <span class="comment">// and set PSH at SEND boundaries</span>
<a name="l00119"></a>00119     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00120"></a>00120     {
<a name="l00121"></a>00121         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>:
<a name="l00122"></a>00122             opp_error(<span class="stringliteral">&quot;Error processing command SEND: connection not open&quot;</span>);
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>:
<a name="l00125"></a>00125             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SEND command turns passive open into active open, sending initial SYN\n&quot;</span>;
<a name="l00126"></a>00126             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#afba4a9f34c546c37533eb5311c1da682">active</a> = <span class="keyword">true</span>;
<a name="l00127"></a>00127             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();
<a name="l00128"></a>00128             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>();
<a name="l00129"></a>00129             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
<a name="l00130"></a>00130             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);
<a name="l00131"></a>00131             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#a8f1b685a3f9020032805d119adb3089a">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));  <span class="comment">// queue up for later</span>
<a name="l00132"></a>00132             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#acf03e0bbf6565ae7df7afa656d97ca18">getBytesAvailable</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue\n&quot;</span>;
<a name="l00133"></a>00133             <span class="keywordflow">break</span>;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>:
<a name="l00136"></a>00136         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>:
<a name="l00137"></a>00137             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Queueing up data for sending later.\n&quot;</span>;
<a name="l00138"></a>00138             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#a8f1b685a3f9020032805d119adb3089a">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg)); <span class="comment">// queue up for later</span>
<a name="l00139"></a>00139             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#acf03e0bbf6565ae7df7afa656d97ca18">getBytesAvailable</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue\n&quot;</span>;
<a name="l00140"></a>00140             <span class="keywordflow">break</span>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>:
<a name="l00143"></a>00143         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>:
<a name="l00144"></a>00144             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#a8f1b685a3f9020032805d119adb3089a">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));
<a name="l00145"></a>00145             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#acf03e0bbf6565ae7df7afa656d97ca18">getBytesAvailable</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue, plus &quot;</span>
<a name="l00146"></a>00146                   &lt;&lt; (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>-<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes unacknowledged\n&quot;</span>;
<a name="l00147"></a>00147             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#ae85b3610dd8b6f93018265812e9eaa74">sendCommandInvoked</a>();
<a name="l00148"></a>00148             <span class="keywordflow">break</span>;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>:
<a name="l00151"></a>00151         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>:
<a name="l00152"></a>00152         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l00153"></a>00153         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a>:
<a name="l00154"></a>00154         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>:
<a name="l00155"></a>00155             opp_error(<span class="stringliteral">&quot;Error processing command SEND: connection closing&quot;</span>);
<a name="l00156"></a>00156     }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     <span class="keyword">delete</span> sendCommand; <span class="comment">// msg itself has been taken by the sendQueue</span>
<a name="l00159"></a>00159 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a519a2b6612737fbdbd5641dfa33833e8"></a><!-- doxytag: member="tcp_old::TCPConnection::process_STATUS" ref="a519a2b6612737fbdbd5641dfa33833e8" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_STATUS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00245">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00254"></a>00254 {
<a name="l00255"></a>00255     <span class="keyword">delete</span> tcpCommand; <span class="comment">// but reuse msg for reply</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>)
<a name="l00258"></a>00258         opp_error(<span class="stringliteral">&quot;Error processing command STATUS: connection not open&quot;</span>);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     <a class="code" href="class_t_c_p_status_info.html">TCPStatusInfo</a> *statusInfo = <span class="keyword">new</span> <a class="code" href="class_t_c_p_status_info.html">TCPStatusInfo</a>();
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a9d53ae33cb699b56e6653f05fbbe39ad">setState</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState());
<a name="l00263"></a>00263     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a4b75cddbe2115eaee18b201848cf8809">setStateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()));
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#aa9b66d12f0fd12fe1d624bf3c3a086c9">setLocalAddr</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>);
<a name="l00266"></a>00266     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#ab724afec9a98a1e8b97aecd215532d09">setRemoteAddr</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>);
<a name="l00267"></a>00267     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a2c331b96b3d2b5985c68acc34e0491b2">setLocalPort</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>);
<a name="l00268"></a>00268     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a563ff999e1ebd3d676bb9b39ae149dc8">setRemotePort</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a>);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a8269ea89d5873e8b621af318edb66e6e">setSnd_mss</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a>);
<a name="l00271"></a>00271     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#aaf950a6e099525bd6fda884422b3f946">setSnd_una</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>);
<a name="l00272"></a>00272     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a87a0e0d0851d4177adb4a36b143f5910">setSnd_nxt</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>);
<a name="l00273"></a>00273     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a8d7c02804ac7faff3875f25077cc5706">setSnd_max</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>);
<a name="l00274"></a>00274     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#abf6e868184dd0bb7ede4fe38967249ce">setSnd_wnd</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a>);
<a name="l00275"></a>00275     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a147a1dfd66eb3febea9c3b319fee33c3">setSnd_up</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a21d3e1fb8154ba3b4fc42e7f5dcbb784">snd_up</a>);
<a name="l00276"></a>00276     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a7590a55627be6e6d881c879da9ca5c8e">setSnd_wl1</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4ddf055ba61bab9723814bfb1f55cfe5">snd_wl1</a>);
<a name="l00277"></a>00277     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a9188adae28c390fba8db3f50518fb476">setSnd_wl2</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aae32069f7798da55852c7244d816b9a1">snd_wl2</a>);
<a name="l00278"></a>00278     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a0634c9ecc358eca78ae06588b1fcf590">setIss</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>);
<a name="l00279"></a>00279     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a51a3f75bdab906d74e9d40ecf3463fd6">setRcv_nxt</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>);
<a name="l00280"></a>00280     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#af48c361b81087bce015098c7f1d599a6">setRcv_wnd</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ab26a1e5c5f13a245ef7578dc87e81cfe">rcv_wnd</a>);
<a name="l00281"></a>00281     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a5a3fde4159c8c44c6e13e70358241c57">setRcv_up</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a9ac465cf0b2699f5b5ec86d7b2811b33">rcv_up</a>);
<a name="l00282"></a>00282     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#aadbf506809640cf65edc754fa1530708">setIrs</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#af9fc103c0361bcaffc4c894627abfc2d">irs</a>);
<a name="l00283"></a>00283     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#ad192278807282716a1a7567856d48605">setFin_ack_rcvd</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ad2deb1000d47f2e1524f1f5dee059b34">fin_ack_rcvd</a>);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     msg-&gt;setControlInfo(statusInfo);
<a name="l00286"></a>00286     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a>(msg);
<a name="l00287"></a>00287 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae29072ef963e593c4c3053827ebbec6e"></a><!-- doxytag: member="tcp_old::TCPConnection::process_TIMEOUT_2MSL" ref="ae29072ef963e593c4c3053827ebbec6e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_2MSL </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01080"></a>01080 {
<a name="l01081"></a>01081     <span class="comment">//&quot;</span>
<a name="l01082"></a>01082     <span class="comment">// If the time-wait timeout expires on a connection delete the TCB,</span>
<a name="l01083"></a>01083     <span class="comment">// enter the CLOSED state and return.</span>
<a name="l01084"></a>01084     <span class="comment">//&quot;</span>
<a name="l01085"></a>01085     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l01086"></a>01086     {
<a name="l01087"></a>01087         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>:
<a name="l01088"></a>01088             <span class="comment">// Nothing to do here. The TIMEOUT_2MSL event will automatically take</span>
<a name="l01089"></a>01089             <span class="comment">// the connection to CLOSED. We already notified the user</span>
<a name="l01090"></a>01090             <span class="comment">// (TCP_I_CLOSED) when we entered the TIME_WAIT state from CLOSING,</span>
<a name="l01091"></a>01091             <span class="comment">// FIN_WAIT_1 or FIN_WAIT_2.</span>
<a name="l01092"></a>01092             <span class="keywordflow">break</span>;
<a name="l01093"></a>01093         <span class="keywordflow">default</span>:
<a name="l01094"></a>01094             <span class="comment">// We should not receive this timeout in this state.</span>
<a name="l01095"></a>01095             opp_error(<span class="stringliteral">&quot;Internal error: received time-wait (2MSL) timeout in state %s&quot;</span>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()));
<a name="l01096"></a>01096     }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7b47d21fa8a97f13cab52097f3332ea6"></a><!-- doxytag: member="tcp_old::TCPConnection::process_TIMEOUT_CONN_ESTAB" ref="a7b47d21fa8a97f13cab52097f3332ea6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_CONN_ESTAB </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01060"></a>01060 {
<a name="l01061"></a>01061     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l01062"></a>01062     {
<a name="l01063"></a>01063         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>:
<a name="l01064"></a>01064         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>:
<a name="l01065"></a>01065             <span class="comment">// Nothing to do here. TIMEOUT_CONN_ESTAB event will automatically</span>
<a name="l01066"></a>01066             <span class="comment">// take the connection to LISTEN or CLOSED, and cancel SYN-REXMIT timer.</span>
<a name="l01067"></a>01067             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#afba4a9f34c546c37533eb5311c1da682">active</a>)
<a name="l01068"></a>01068             {
<a name="l01069"></a>01069                 <span class="comment">// notify user if we&#39;re on the active side</span>
<a name="l01070"></a>01070                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba06629e44a0aef5201b4cd424596127bf">TCP_I_TIMED_OUT</a>);
<a name="l01071"></a>01071             }
<a name="l01072"></a>01072             <span class="keywordflow">break</span>;
<a name="l01073"></a>01073         <span class="keywordflow">default</span>:
<a name="l01074"></a>01074             <span class="comment">// We should not receive this timeout in this state.</span>
<a name="l01075"></a>01075             opp_error(<span class="stringliteral">&quot;Internal error: received CONN_ESTAB timeout in state %s&quot;</span>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()));
<a name="l01076"></a>01076     }
<a name="l01077"></a>01077 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53d62d237307ad56bae8d320ff557e48"></a><!-- doxytag: member="tcp_old::TCPConnection::process_TIMEOUT_FIN_WAIT_2" ref="a53d62d237307ad56bae8d320ff557e48" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_FIN_WAIT_2 </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01101"></a>01101 {
<a name="l01102"></a>01102     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l01103"></a>01103     {
<a name="l01104"></a>01104         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l01105"></a>01105             <span class="comment">// Nothing to do here. The TIMEOUT_FIN_WAIT_2 event will automatically take</span>
<a name="l01106"></a>01106             <span class="comment">// the connection to CLOSED.</span>
<a name="l01107"></a>01107             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l01108"></a>01108             <span class="keywordflow">break</span>;
<a name="l01109"></a>01109         <span class="keywordflow">default</span>:
<a name="l01110"></a>01110             <span class="comment">// We should not receive this timeout in this state.</span>
<a name="l01111"></a>01111             opp_error(<span class="stringliteral">&quot;Internal error: received FIN_WAIT_2 timeout in state %s&quot;</span>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()));
<a name="l01112"></a>01112     }
<a name="l01113"></a>01113 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a33c6fe420de8b7fc6c09761f70118ed0"></a><!-- doxytag: member="tcp_old::TCPConnection::process_TIMEOUT_SYN_REXMIT" ref="a33c6fe420de8b7fc6c09761f70118ed0" args="(TCPEventCode &amp;event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_SYN_REXMIT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01126"></a>01126 {
<a name="l01127"></a>01127     <span class="keywordflow">if</span> (++<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#add0426103a74138a0599e58049526e8a">syn_rexmit_count</a>&gt;<a class="code" href="_t_c_p_connection_8h.html#acd69c7cf1d3622b1d7aa706d7f9b97f9">MAX_SYN_REXMIT_COUNT</a>)
<a name="l01128"></a>01128     {
<a name="l01129"></a>01129         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Retransmission count during connection setup exceeds &quot;</span> &lt;&lt; <a class="code" href="_t_c_p_connection_8h.html#acd69c7cf1d3622b1d7aa706d7f9b97f9">MAX_SYN_REXMIT_COUNT</a> &lt;&lt; <span class="stringliteral">&quot;, giving up\n&quot;</span>;
<a name="l01130"></a>01130         <span class="comment">// Note ABORT will take the connection to closed, and cancel CONN-ESTAB timer as well</span>
<a name="l01131"></a>01131         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>;
<a name="l01132"></a>01132         <span class="keywordflow">return</span>;
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Performing retransmission #&quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#add0426103a74138a0599e58049526e8a">syn_rexmit_count</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01136"></a>01136 
<a name="l01137"></a>01137     <span class="comment">// resend what&#39;s needed</span>
<a name="l01138"></a>01138     <span class="keywordflow">switch</span>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l01139"></a>01139     {
<a name="l01140"></a>01140         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>: <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>(); <span class="keywordflow">break</span>;
<a name="l01141"></a>01141         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>: <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>(); <span class="keywordflow">break</span>;
<a name="l01142"></a>01142         <span class="keywordflow">default</span>:  opp_error(<span class="stringliteral">&quot;Internal error: SYN-REXMIT timer expired while in state %s&quot;</span>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()));
<a name="l01143"></a>01143     }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145     <span class="comment">// reschedule timer</span>
<a name="l01146"></a>01146     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a9aec9c42959150643d39bde968908d39">syn_rexmit_timeout</a> *= 2;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a9aec9c42959150643d39bde968908d39">syn_rexmit_timeout</a> &gt; <a class="code" href="_t_c_p_connection_8h.html#a0b48410b2bd35dbc6509568bfb1842aa">TCP_TIMEOUT_SYN_REXMIT_MAX</a>)
<a name="l01149"></a>01149         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a9aec9c42959150643d39bde968908d39">syn_rexmit_timeout</a> = <a class="code" href="_t_c_p_connection_8h.html#a0b48410b2bd35dbc6509568bfb1842aa">TCP_TIMEOUT_SYN_REXMIT_MAX</a>;
<a name="l01150"></a>01150     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a9aec9c42959150643d39bde968908d39">syn_rexmit_timeout</a>);
<a name="l01151"></a>01151 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1144f5ca6e960176d6e623998cb7456"></a><!-- doxytag: member="tcp_old::TCPConnection::processAckInEstabEtc" ref="ac1144f5ca6e960176d6e623998cb7456" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processAckInEstabEtc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00938"></a>00938 {
<a name="l00939"></a>00939     <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing ACK in a data transfer state\n&quot;</span>;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="comment">//</span>
<a name="l00942"></a>00942     <span class="comment">//&quot;</span>
<a name="l00943"></a>00943     <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
<a name="l00944"></a>00944     <span class="comment">//  Any segments on the retransmission queue which are thereby</span>
<a name="l00945"></a>00945     <span class="comment">//  entirely acknowledged are removed.  Users should receive</span>
<a name="l00946"></a>00946     <span class="comment">//  positive acknowledgments for buffers which have been SENT and</span>
<a name="l00947"></a>00947     <span class="comment">//  fully acknowledged (i.e., SEND buffer should be returned with</span>
<a name="l00948"></a>00948     <span class="comment">//  &quot;ok&quot; response).  If the ACK is a duplicate</span>
<a name="l00949"></a>00949     <span class="comment">//  (SEG.ACK &lt; SND.UNA), it can be ignored.  If the ACK acks</span>
<a name="l00950"></a>00950     <span class="comment">//  something not yet sent (SEG.ACK &gt; SND.NXT) then send an ACK,</span>
<a name="l00951"></a>00951     <span class="comment">//  drop the segment, and return.</span>
<a name="l00952"></a>00952     <span class="comment">//</span>
<a name="l00953"></a>00953     <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT, the send window should be</span>
<a name="l00954"></a>00954     <span class="comment">//  updated.  If (SND.WL1 &lt; SEG.SEQ or (SND.WL1 = SEG.SEQ and</span>
<a name="l00955"></a>00955     <span class="comment">//  SND.WL2 =&lt; SEG.ACK)), set SND.WND &lt;- SEG.WND, set</span>
<a name="l00956"></a>00956     <span class="comment">//  SND.WL1 &lt;- SEG.SEQ, and set SND.WL2 &lt;- SEG.ACK.</span>
<a name="l00957"></a>00957     <span class="comment">//</span>
<a name="l00958"></a>00958     <span class="comment">//  Note that SND.WND is an offset from SND.UNA, that SND.WL1</span>
<a name="l00959"></a>00959     <span class="comment">//  records the sequence number of the last segment used to update</span>
<a name="l00960"></a>00960     <span class="comment">//  SND.WND, and that SND.WL2 records the acknowledgment number of</span>
<a name="l00961"></a>00961     <span class="comment">//  the last segment used to update SND.WND.  The check here</span>
<a name="l00962"></a>00962     <span class="comment">//  prevents using old segments to update the window.</span>
<a name="l00963"></a>00963     <span class="comment">//&quot;</span>
<a name="l00964"></a>00964     <span class="comment">// Note: should use SND.MAX instead of SND.NXT in above checks</span>
<a name="l00965"></a>00965     <span class="comment">//</span>
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a0012c6f2a0631480574729efd85a05c9">seqGE</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()))
<a name="l00967"></a>00967     {
<a name="l00968"></a>00968         <span class="comment">//</span>
<a name="l00969"></a>00969         <span class="comment">// duplicate ACK? A received TCP segment is a duplicate ACK if all of</span>
<a name="l00970"></a>00970         <span class="comment">// the following apply:</span>
<a name="l00971"></a>00971         <span class="comment">//    (1) snd_una==ackNo</span>
<a name="l00972"></a>00972         <span class="comment">//    (2) segment contains no data</span>
<a name="l00973"></a>00973         <span class="comment">//    (3) there&#39;s unacked data (snd_una!=snd_max)</span>
<a name="l00974"></a>00974         <span class="comment">//</span>
<a name="l00975"></a>00975         <span class="comment">// Note: ssfnet uses additional constraint &quot;window is the same as last</span>
<a name="l00976"></a>00976         <span class="comment">// received (not an update)&quot; -- we don&#39;t do that because window updates</span>
<a name="l00977"></a>00977         <span class="comment">// are ignored anyway if neither seqNo nor ackNo has changed.</span>
<a name="l00978"></a>00978         <span class="comment">//</span>
<a name="l00979"></a>00979         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>() &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()==0 &amp;&amp;
<a name="l00980"></a>00980             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>!=<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>)
<a name="l00981"></a>00981         {
<a name="l00982"></a>00982             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74cb98612a9fa541a2682e33f3991582">dupacks</a>++;
<a name="l00983"></a>00983             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a7ea85ca6cca058d942c83cb76eb3109a">receivedDuplicateAck</a>();
<a name="l00984"></a>00984         }
<a name="l00985"></a>00985         <span class="keywordflow">else</span>
<a name="l00986"></a>00986         {
<a name="l00987"></a>00987             <span class="comment">// if doesn&#39;t qualify as duplicate ACK, just ignore it.</span>
<a name="l00988"></a>00988             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()==0)
<a name="l00989"></a>00989             {
<a name="l00990"></a>00990                 <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>!=tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>())
<a name="l00991"></a>00991                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Old ACK: ackNo&lt;snd_una\n&quot;</span>;
<a name="l00992"></a>00992                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>)
<a name="l00993"></a>00993                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK looks duplicate but we have currently no unacked data (snd_una==snd_max)\n&quot;</span>;
<a name="l00994"></a>00994             }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996             <span class="comment">// reset counter</span>
<a name="l00997"></a>00997             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74cb98612a9fa541a2682e33f3991582">dupacks</a> = 0;
<a name="l00998"></a>00998         }
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a2a4d76c437a6e0eb1e1440c02153e5db">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(), <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>))
<a name="l01001"></a>01001     {
<a name="l01002"></a>01002         <span class="comment">// ack in window.</span>
<a name="l01003"></a>01003         uint32 old_snd_una = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>;
<a name="l01004"></a>01004         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>();
<a name="l01005"></a>01005         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>-&gt;record(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> - <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>);
<a name="l01006"></a>01006 
<a name="l01007"></a>01007         <span class="comment">// after retransmitting a lost segment, we may get an ack well ahead of snd_nxt</span>
<a name="l01008"></a>01008         <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a17c7a0744a549bb90de7d1bc6b8b72ad">seqLess</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>))
<a name="l01009"></a>01009             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>;
<a name="l01010"></a>01010 
<a name="l01011"></a>01011         uint32 discardUpToSeq = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013         <span class="comment">// our FIN acked?</span>
<a name="l01014"></a>01014         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a2a8d544b5707071afcc5402e6318e245">send_fin</a> &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a1156c4cdd71d0e83c9bb401a68e9f606">snd_fin_seq</a>+1)
<a name="l01015"></a>01015         {
<a name="l01016"></a>01016             <span class="comment">// set flag that our FIN has been acked</span>
<a name="l01017"></a>01017             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK acks our FIN\n&quot;</span>;
<a name="l01018"></a>01018             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ad2deb1000d47f2e1524f1f5dee059b34">fin_ack_rcvd</a> = <span class="keyword">true</span>;
<a name="l01019"></a>01019             discardUpToSeq--; <span class="comment">// the FIN sequence number is not real data</span>
<a name="l01020"></a>01020         }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022         <span class="comment">// acked data no longer needed in send queue</span>
<a name="l01023"></a>01023         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#aced2fde7fde0ec8f6a32b1e16d6bbda9">discardUpTo</a>(discardUpToSeq);
<a name="l01024"></a>01024 
<a name="l01025"></a>01025         <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a17c7a0744a549bb90de7d1bc6b8b72ad">seqLess</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4ddf055ba61bab9723814bfb1f55cfe5">snd_wl1</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()) ||
<a name="l01026"></a>01026             (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4ddf055ba61bab9723814bfb1f55cfe5">snd_wl1</a>==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() &amp;&amp; <a class="code" href="namespacetcp__old.html#a2a4d76c437a6e0eb1e1440c02153e5db">seqLE</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aae32069f7798da55852c7244d816b9a1">snd_wl2</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>())))
<a name="l01027"></a>01027         {
<a name="l01028"></a>01028             <span class="comment">// send window should be updated</span>
<a name="l01029"></a>01029             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Updating send window from segment: new wnd=&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01030"></a>01030             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>();
<a name="l01031"></a>01031             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4ddf055ba61bab9723814bfb1f55cfe5">snd_wl1</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l01032"></a>01032             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aae32069f7798da55852c7244d816b9a1">snd_wl2</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>();
<a name="l01033"></a>01033             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a>-&gt;record(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a>);
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>() == 0 &amp;&amp; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()!=<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>) <span class="comment">// if segment contains data, wait until data has been forwarded to app before sending ACK, otherwise we would use an old ACKNo</span>
<a name="l01037"></a>01037         {
<a name="l01038"></a>01038             <span class="comment">// notify</span>
<a name="l01039"></a>01039             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#aca06733ab569ab16f026d31a3bfe5077">receivedDataAck</a>(old_snd_una);
<a name="l01040"></a>01040 
<a name="l01041"></a>01041             <span class="comment">// in the receivedDataAck we need the old value</span>
<a name="l01042"></a>01042             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74cb98612a9fa541a2682e33f3991582">dupacks</a> = 0;
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044     }
<a name="l01045"></a>01045     <span class="keywordflow">else</span>
<a name="l01046"></a>01046     {
<a name="l01047"></a>01047         ASSERT(<a class="code" href="namespacetcp__old.html#a91800c1929091c104e787a01f5955a9f">seqGreater</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(), <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>)); <span class="comment">// from if-ladder</span>
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         <span class="comment">// send an ACK, drop the segment, and return.</span>
<a name="l01050"></a>01050         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a9f6805c97af24ed1cfe2b94adf983a64">receivedAckForDataNotYetSent</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>());
<a name="l01051"></a>01051         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74cb98612a9fa541a2682e33f3991582">dupacks</a> = 0;
<a name="l01052"></a>01052         <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// means &quot;drop&quot;</span>
<a name="l01053"></a>01053     }
<a name="l01054"></a>01054     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01055"></a>01055 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aebf3e44d104151c83a84a1efbae3f312"></a><!-- doxytag: member="tcp_old::TCPConnection::processAppCommand" ref="aebf3e44d104151c83a84a1efbae3f312" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processAppCommand </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process commands from the application. Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a>). </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00084">tcp_old::TCP::handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00246"></a>00246 {
<a name="l00247"></a>00247     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="comment">// first do actions</span>
<a name="l00250"></a>00250     <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand = (<a class="code" href="class_t_c_p_command.html">TCPCommand</a> *)(msg-&gt;removeControlInfo());
<a name="l00251"></a>00251     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a792d9159b4e64b344cac79d0716c907a">preanalyseAppCommandEvent</a>(msg-&gt;getKind());
<a name="l00252"></a>00252     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;App command: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00253"></a>00253     <span class="keywordflow">switch</span> (event)
<a name="l00254"></a>00254     {
<a name="l00255"></a>00255         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6179df5a4a1f3314be52f5789f5f0bb6">TCP_E_OPEN_ACTIVE</a>: <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00256"></a>00256         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a11dd6ccbd9b9bbb145b64fb99981b530">TCP_E_OPEN_PASSIVE</a>: <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00257"></a>00257         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32af5e9f1961ac4c76e49f568d8fd304063">TCP_E_SEND</a>: <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00258"></a>00258         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>: <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00259"></a>00259         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a1fd07d5de8615b02fe30cc7159af37af">TCP_E_ABORT</a>: <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00260"></a>00260         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32adea9b33ab4047345817fb7d8066a8ae2">TCP_E_STATUS</a>: <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00261"></a>00261         <span class="keywordflow">default</span>: opp_error(<span class="stringliteral">&quot;wrong event code&quot;</span>);
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <span class="comment">// then state transitions</span>
<a name="l00265"></a>00265     <span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
<a name="l00266"></a>00266 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d240ca8f36aa37a29b8bcc44ec052cd"></a><!-- doxytag: member="tcp_old::TCPConnection::processRstInSynReceived" ref="a4d240ca8f36aa37a29b8bcc44ec052cd" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> TCPConnection::processRstInSynReceived </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00910"></a>00910 {
<a name="l00911"></a>00911     <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing RST in SYN_RCVD\n&quot;</span>;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913     <span class="comment">//&quot;</span>
<a name="l00914"></a>00914     <span class="comment">// If this connection was initiated with a passive OPEN (i.e.,</span>
<a name="l00915"></a>00915     <span class="comment">// came from the LISTEN state), then return this connection to</span>
<a name="l00916"></a>00916     <span class="comment">// LISTEN state and return.  The user need not be informed.  If</span>
<a name="l00917"></a>00917     <span class="comment">// this connection was initiated with an active OPEN (i.e., came</span>
<a name="l00918"></a>00918     <span class="comment">// from SYN-SENT state) then the connection was refused, signal</span>
<a name="l00919"></a>00919     <span class="comment">// the user &quot;connection refused&quot;.  In either case, all segments</span>
<a name="l00920"></a>00920     <span class="comment">// on the retransmission queue should be removed.  And in the</span>
<a name="l00921"></a>00921     <span class="comment">// active OPEN case, enter the CLOSED state and delete the TCB,</span>
<a name="l00922"></a>00922     <span class="comment">// and return.</span>
<a name="l00923"></a>00923     <span class="comment">//&quot;</span>
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#aced2fde7fde0ec8f6a32b1e16d6bbda9">discardUpTo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#addf53d15d095b683486ca61554dccae3">getBufferEndSeq</a>()); <span class="comment">// flush send queue</span>
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#afba4a9f34c546c37533eb5311c1da682">active</a>)
<a name="l00928"></a>00928     {
<a name="l00929"></a>00929         <span class="comment">// signal &quot;connection refused&quot;</span>
<a name="l00930"></a>00930         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba21824d5a95e3b86c41f35775bb5f23ab">TCP_I_CONNECTION_REFUSED</a>);
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <span class="comment">// on RCV_RST, FSM will go either to LISTEN or to CLOSED, depending on state-&gt;active</span>
<a name="l00934"></a>00934     <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>;
<a name="l00935"></a>00935 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa0758284e5bd6bd162b6ff267add2e2d"></a><!-- doxytag: member="tcp_old::TCPConnection::processSegment1stThru8th" ref="aa0758284e5bd6bd162b6ff267add2e2d" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> TCPConnection::processSegment1stThru8th </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116     <span class="comment">//</span>
<a name="l00117"></a>00117     <span class="comment">// RFC 793: first check sequence number</span>
<a name="l00118"></a>00118     <span class="comment">//</span>
<a name="l00119"></a>00119     <span class="keywordtype">bool</span> acceptable = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a>(tcpseg);
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (!acceptable)
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122         <span class="comment">//&quot;</span>
<a name="l00123"></a>00123         <span class="comment">// If an incoming segment is not acceptable, an acknowledgment</span>
<a name="l00124"></a>00124         <span class="comment">// should be sent in reply (unless the RST bit is set, if so drop</span>
<a name="l00125"></a>00125         <span class="comment">// the segment and return):</span>
<a name="l00126"></a>00126         <span class="comment">//</span>
<a name="l00127"></a>00127         <span class="comment">//  &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
<a name="l00128"></a>00128         <span class="comment">//&quot;</span>
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00130"></a>00130         {
<a name="l00131"></a>00131             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST with unacceptable seqNum: dropping\n&quot;</span>;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133         <span class="keywordflow">else</span>
<a name="l00134"></a>00134         {
<a name="l00135"></a>00135             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Segment seqNum not acceptable, sending ACK with current receive seq\n&quot;</span>;
<a name="l00136"></a>00136             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a>();
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138         <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     <span class="comment">//</span>
<a name="l00142"></a>00142     <span class="comment">// RFC 793: second check the RST bit,</span>
<a name="l00143"></a>00143     <span class="comment">//</span>
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00145"></a>00145     {
<a name="l00146"></a>00146         <span class="comment">// Note: if we come from LISTEN, processSegmentInListen() has already handled RST.</span>
<a name="l00147"></a>00147         <span class="keywordflow">switch</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00148"></a>00148         {
<a name="l00149"></a>00149             <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>:
<a name="l00150"></a>00150                 <span class="comment">//&quot;</span>
<a name="l00151"></a>00151                 <span class="comment">// If this connection was initiated with a passive OPEN (i.e.,</span>
<a name="l00152"></a>00152                 <span class="comment">// came from the LISTEN state), then return this connection to</span>
<a name="l00153"></a>00153                 <span class="comment">// LISTEN state and return.  The user need not be informed.  If</span>
<a name="l00154"></a>00154                 <span class="comment">// this connection was initiated with an active OPEN (i.e., came</span>
<a name="l00155"></a>00155                 <span class="comment">// from SYN-SENT state) then the connection was refused, signal</span>
<a name="l00156"></a>00156                 <span class="comment">// the user &quot;connection refused&quot;.  In either case, all segments</span>
<a name="l00157"></a>00157                 <span class="comment">// on the retransmission queue should be removed.  And in the</span>
<a name="l00158"></a>00158                 <span class="comment">// active OPEN case, enter the CLOSED state and delete the TCB,</span>
<a name="l00159"></a>00159                 <span class="comment">// and return.</span>
<a name="l00160"></a>00160                 <span class="comment">//&quot;</span>
<a name="l00161"></a>00161                 <span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived</a>(tcpseg);
<a name="l00162"></a>00162 
<a name="l00163"></a>00163             <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>:
<a name="l00164"></a>00164             <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>:
<a name="l00165"></a>00165             <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l00166"></a>00166             <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>:
<a name="l00167"></a>00167                 <span class="comment">//&quot;</span>
<a name="l00168"></a>00168                 <span class="comment">// If the RST bit is set then, any outstanding RECEIVEs and SEND</span>
<a name="l00169"></a>00169                 <span class="comment">// should receive &quot;reset&quot; responses.  All segment queues should be</span>
<a name="l00170"></a>00170                 <span class="comment">// flushed.  Users should also receive an unsolicited general</span>
<a name="l00171"></a>00171                 <span class="comment">// &quot;connection reset&quot; signal.</span>
<a name="l00172"></a>00172                 <span class="comment">//</span>
<a name="l00173"></a>00173                 <span class="comment">// Enter the CLOSED state, delete the TCB, and return.</span>
<a name="l00174"></a>00174                 <span class="comment">//&quot;</span>
<a name="l00175"></a>00175                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST: performing connection reset, closing connection\n&quot;</span>;
<a name="l00176"></a>00176                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba4e8f4551a34a27e607201754b36fdbe0">TCP_I_CONNECTION_RESET</a>);
<a name="l00177"></a>00177                 <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>;  <span class="comment">// this will trigger state transition</span>
<a name="l00178"></a>00178 
<a name="l00179"></a>00179             <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a>:
<a name="l00180"></a>00180             <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>:
<a name="l00181"></a>00181             <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>:
<a name="l00182"></a>00182                 <span class="comment">//&quot;</span>
<a name="l00183"></a>00183                 <span class="comment">// enter the CLOSED state, delete the TCB, and return.</span>
<a name="l00184"></a>00184                 <span class="comment">//&quot;</span>
<a name="l00185"></a>00185                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST: closing connection\n&quot;</span>;
<a name="l00186"></a>00186                 <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()!=<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>)
<a name="l00187"></a>00187                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>); <span class="comment">// in TIME_WAIT, we&#39;ve already sent it</span>
<a name="l00188"></a>00188                 <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>; <span class="comment">// this will trigger state transition</span>
<a name="l00189"></a>00189 
<a name="l00190"></a>00190             <span class="keywordflow">default</span>: ASSERT(0);
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="comment">// RFC 793: third check security and precedence</span>
<a name="l00195"></a>00195     <span class="comment">// This step is ignored.</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="comment">//</span>
<a name="l00198"></a>00198     <span class="comment">// RFC 793: fourth, check the SYN bit,</span>
<a name="l00199"></a>00199     <span class="comment">//</span>
<a name="l00200"></a>00200     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202         <span class="comment">//&quot;</span>
<a name="l00203"></a>00203         <span class="comment">// If the SYN is in the window it is an error, send a reset, any</span>
<a name="l00204"></a>00204         <span class="comment">// outstanding RECEIVEs and SEND should receive &quot;reset&quot; responses,</span>
<a name="l00205"></a>00205         <span class="comment">// all segment queues should be flushed, the user should also</span>
<a name="l00206"></a>00206         <span class="comment">// receive an unsolicited general &quot;connection reset&quot; signal, enter</span>
<a name="l00207"></a>00207         <span class="comment">// the CLOSED state, delete the TCB, and return.</span>
<a name="l00208"></a>00208         <span class="comment">//</span>
<a name="l00209"></a>00209         <span class="comment">// If the SYN is not in the window this step would not be reached</span>
<a name="l00210"></a>00210         <span class="comment">// and an ack would have been sent in the first step (sequence</span>
<a name="l00211"></a>00211         <span class="comment">// number check).</span>
<a name="l00212"></a>00212         <span class="comment">//&quot;</span>
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         ASSERT(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a>(tcpseg));  <span class="comment">// assert SYN is in the window</span>
<a name="l00215"></a>00215         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN is in the window: performing connection reset, closing connection\n&quot;</span>;
<a name="l00216"></a>00216         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba4e8f4551a34a27e607201754b36fdbe0">TCP_I_CONNECTION_RESET</a>);
<a name="l00217"></a>00217         <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a55dbf4b3147f64f1baeac365b019dea6">TCP_E_RCV_UNEXP_SYN</a>;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="comment">//</span>
<a name="l00221"></a>00221     <span class="comment">// RFC 793: fifth check the ACK field,</span>
<a name="l00222"></a>00222     <span class="comment">//</span>
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (!tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225         <span class="comment">// if the ACK bit is off drop the segment and return</span>
<a name="l00226"></a>00226         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK not set, dropping segment\n&quot;</span>;
<a name="l00227"></a>00227         <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     uint32 old_snd_una = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>)
<a name="l00235"></a>00235     {
<a name="l00236"></a>00236         <span class="comment">//&quot;</span>
<a name="l00237"></a>00237         <span class="comment">// If SND.UNA =&lt; SEG.ACK =&lt; SND.NXT then enter ESTABLISHED state</span>
<a name="l00238"></a>00238         <span class="comment">// and continue processing.</span>
<a name="l00239"></a>00239         <span class="comment">//</span>
<a name="l00240"></a>00240         <span class="comment">// If the segment acknowledgment is not acceptable, form a</span>
<a name="l00241"></a>00241         <span class="comment">// reset segment,</span>
<a name="l00242"></a>00242         <span class="comment">//</span>
<a name="l00243"></a>00243         <span class="comment">//  &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
<a name="l00244"></a>00244         <span class="comment">//</span>
<a name="l00245"></a>00245         <span class="comment">// and send it.</span>
<a name="l00246"></a>00246         <span class="comment">//&quot;</span>
<a name="l00247"></a>00247         <span class="keywordflow">if</span> (!<a class="code" href="namespacetcp__old.html#a2a4d76c437a6e0eb1e1440c02153e5db">seqLE</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()) || !<a class="code" href="namespacetcp__old.html#a2a4d76c437a6e0eb1e1440c02153e5db">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>))
<a name="l00248"></a>00248         {
<a name="l00249"></a>00249             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>());
<a name="l00250"></a>00250             <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="comment">// notify tcpAlgorithm and app layer</span>
<a name="l00254"></a>00254         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a6bbeaec803a6c9e148ba36c838c267a5">established</a>(<span class="keyword">false</span>);
<a name="l00255"></a>00255         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a>();
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="comment">// This will trigger transition to ESTABLISHED. Timers and notifying</span>
<a name="l00258"></a>00258         <span class="comment">// app will be taken care of in stateEntered().</span>
<a name="l00259"></a>00259         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>;
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     uint32 old_snd_nxt = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>; <span class="comment">// later we&#39;ll need to see if snd_nxt changed</span>
<a name="l00263"></a>00263     <span class="comment">// Note: If one of the last data segments is lost while already in LAST-ACK state (e.g. if using TCPEchoApps)</span>
<a name="l00264"></a>00264     <span class="comment">// TCP must be able to process acceptable acknowledgments, however please note RFC 793, page 73:</span>
<a name="l00265"></a>00265         <span class="comment">// &quot;LAST-ACK STATE</span>
<a name="l00266"></a>00266     <span class="comment">//    The only thing that can arrive in this state is an</span>
<a name="l00267"></a>00267     <span class="comment">//    acknowledgment of our FIN.  If our FIN is now acknowledged,</span>
<a name="l00268"></a>00268     <span class="comment">//    delete the TCB, enter the CLOSED state, and return.&quot;</span>
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a> ||
<a name="l00270"></a>00270         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a> ||
<a name="l00271"></a>00271         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>)
<a name="l00272"></a>00272     {
<a name="l00273"></a>00273         <span class="comment">//</span>
<a name="l00274"></a>00274         <span class="comment">// ESTABLISHED processing:</span>
<a name="l00275"></a>00275         <span class="comment">//&quot;</span>
<a name="l00276"></a>00276         <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
<a name="l00277"></a>00277         <span class="comment">//  Any segments on the retransmission queue which are thereby</span>
<a name="l00278"></a>00278         <span class="comment">//  entirely acknowledged are removed.  Users should receive</span>
<a name="l00279"></a>00279         <span class="comment">//  positive acknowledgments for buffers which have been SENT and</span>
<a name="l00280"></a>00280         <span class="comment">//  fully acknowledged (i.e., SEND buffer should be returned with</span>
<a name="l00281"></a>00281         <span class="comment">//  &quot;ok&quot; response).  If the ACK is a duplicate</span>
<a name="l00282"></a>00282         <span class="comment">//  (SEG.ACK &lt; SND.UNA), it can be ignored.  If the ACK acks</span>
<a name="l00283"></a>00283         <span class="comment">//  something not yet sent (SEG.ACK &gt; SND.NXT) then send an ACK,</span>
<a name="l00284"></a>00284         <span class="comment">//  drop the segment, and return.</span>
<a name="l00285"></a>00285         <span class="comment">//</span>
<a name="l00286"></a>00286         <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT, the send window should be</span>
<a name="l00287"></a>00287         <span class="comment">//  updated.  If (SND.WL1 &lt; SEG.SEQ or (SND.WL1 = SEG.SEQ and</span>
<a name="l00288"></a>00288         <span class="comment">//  SND.WL2 =&lt; SEG.ACK)), set SND.WND &lt;- SEG.WND, set</span>
<a name="l00289"></a>00289         <span class="comment">//  SND.WL1 &lt;- SEG.SEQ, and set SND.WL2 &lt;- SEG.ACK.</span>
<a name="l00290"></a>00290         <span class="comment">//</span>
<a name="l00291"></a>00291         <span class="comment">//  Note that SND.WND is an offset from SND.UNA, that SND.WL1</span>
<a name="l00292"></a>00292         <span class="comment">//  records the sequence number of the last segment used to update</span>
<a name="l00293"></a>00293         <span class="comment">//  SND.WND, and that SND.WL2 records the acknowledgment number of</span>
<a name="l00294"></a>00294         <span class="comment">//  the last segment used to update SND.WND.  The check here</span>
<a name="l00295"></a>00295         <span class="comment">//  prevents using old segments to update the window.</span>
<a name="l00296"></a>00296         <span class="comment">//&quot;</span>
<a name="l00297"></a>00297         <span class="keywordtype">bool</span> ok = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc</a>(tcpseg);
<a name="l00298"></a>00298         <span class="keywordflow">if</span> (!ok)
<a name="l00299"></a>00299             <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;  <span class="comment">// if acks something not yet sent, drop it</span>
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="keywordflow">if</span> ((<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a> &amp;&amp; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ad2deb1000d47f2e1524f1f5dee059b34">fin_ack_rcvd</a>))
<a name="l00303"></a>00303     {
<a name="l00304"></a>00304         <span class="comment">//&quot;</span>
<a name="l00305"></a>00305         <span class="comment">// FIN-WAIT-1 STATE</span>
<a name="l00306"></a>00306         <span class="comment">//   In addition to the processing for the ESTABLISHED state, if</span>
<a name="l00307"></a>00307         <span class="comment">//   our FIN is now acknowledged then enter FIN-WAIT-2 and continue</span>
<a name="l00308"></a>00308         <span class="comment">//   processing in that state.</span>
<a name="l00309"></a>00309         <span class="comment">//&quot;</span>
<a name="l00310"></a>00310         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>;  <span class="comment">// will trigger transition to FIN-WAIT-2</span>
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>)
<a name="l00314"></a>00314     {
<a name="l00315"></a>00315         <span class="comment">//&quot;</span>
<a name="l00316"></a>00316         <span class="comment">// FIN-WAIT-2 STATE</span>
<a name="l00317"></a>00317         <span class="comment">//  In addition to the processing for the ESTABLISHED state, if</span>
<a name="l00318"></a>00318         <span class="comment">//  the retransmission queue is empty, the user&#39;s CLOSE can be</span>
<a name="l00319"></a>00319         <span class="comment">//  acknowledged (&quot;ok&quot;) but do not delete the TCB.</span>
<a name="l00320"></a>00320         <span class="comment">//&quot;</span>
<a name="l00321"></a>00321         <span class="comment">// nothing to do here (in our model, used commands don&#39;t need to be</span>
<a name="l00322"></a>00322         <span class="comment">// acknowledged)</span>
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a>)
<a name="l00326"></a>00326     {
<a name="l00327"></a>00327         <span class="comment">//&quot;</span>
<a name="l00328"></a>00328         <span class="comment">// In addition to the processing for the ESTABLISHED state, if</span>
<a name="l00329"></a>00329         <span class="comment">// the ACK acknowledges our FIN then enter the TIME-WAIT state,</span>
<a name="l00330"></a>00330         <span class="comment">// otherwise ignore the segment.</span>
<a name="l00331"></a>00331         <span class="comment">//&quot;</span>
<a name="l00332"></a>00332         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ad2deb1000d47f2e1524f1f5dee059b34">fin_ack_rcvd</a>)
<a name="l00333"></a>00333         {
<a name="l00334"></a>00334             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Our FIN acked -- can go to TIME_WAIT now\n&quot;</span>;
<a name="l00335"></a>00335             <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>;  <span class="comment">// will trigger transition to TIME-WAIT</span>
<a name="l00336"></a>00336             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);  <span class="comment">// start timer</span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338             <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00339"></a>00339             <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00340"></a>00340             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00341"></a>00341         }
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>)
<a name="l00345"></a>00345     {
<a name="l00346"></a>00346         <span class="comment">//&quot;</span>
<a name="l00347"></a>00347         <span class="comment">// The only thing that can arrive in this state is an</span>
<a name="l00348"></a>00348         <span class="comment">// acknowledgment of our FIN.  If our FIN is now acknowledged,</span>
<a name="l00349"></a>00349         <span class="comment">// delete the TCB, enter the CLOSED state, and return.</span>
<a name="l00350"></a>00350         <span class="comment">//&quot;</span>
<a name="l00351"></a>00351         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a2a8d544b5707071afcc5402e6318e245">send_fin</a> &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a1156c4cdd71d0e83c9bb401a68e9f606">snd_fin_seq</a>+1)
<a name="l00352"></a>00352         {
<a name="l00353"></a>00353             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Last ACK arrived\n&quot;</span>;
<a name="l00354"></a>00354             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00355"></a>00355             <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a823e4834ff13aaff8408c38ac1b0f350">TCP_E_RCV_ACK</a>; <span class="comment">// will trigger transition to CLOSED</span>
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>)
<a name="l00360"></a>00360     {
<a name="l00361"></a>00361         <span class="comment">//&quot;</span>
<a name="l00362"></a>00362         <span class="comment">// The only thing that can arrive in this state is a</span>
<a name="l00363"></a>00363         <span class="comment">// retransmission of the remote FIN.  Acknowledge it, and restart</span>
<a name="l00364"></a>00364         <span class="comment">// the 2 MSL timeout.</span>
<a name="l00365"></a>00365         <span class="comment">//&quot;</span>
<a name="l00366"></a>00366         <span class="comment">// And we are staying in the TIME_WAIT state.</span>
<a name="l00367"></a>00367         <span class="comment">//</span>
<a name="l00368"></a>00368         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a>();
<a name="l00369"></a>00369         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>);
<a name="l00370"></a>00370         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="comment">//</span>
<a name="l00374"></a>00374     <span class="comment">// RFC 793: sixth, check the URG bit,</span>
<a name="l00375"></a>00375     <span class="comment">//</span>
<a name="l00376"></a>00376     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>() &amp;&amp; (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a> ||
<a name="l00377"></a>00377         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>))
<a name="l00378"></a>00378     {
<a name="l00379"></a>00379         <span class="comment">//&quot;</span>
<a name="l00380"></a>00380         <span class="comment">// If the URG bit is set, RCV.UP &lt;- max(RCV.UP,SEG.UP), and signal</span>
<a name="l00381"></a>00381         <span class="comment">// the user that the remote side has urgent data if the urgent</span>
<a name="l00382"></a>00382         <span class="comment">// pointer (RCV.UP) is in advance of the data consumed.  If the</span>
<a name="l00383"></a>00383         <span class="comment">// user has already been signaled (or is still in the &quot;urgent</span>
<a name="l00384"></a>00384         <span class="comment">// mode&quot;) for this continuous sequence of urgent data, do not</span>
<a name="l00385"></a>00385         <span class="comment">// signal the user again.</span>
<a name="l00386"></a>00386         <span class="comment">//&quot;</span>
<a name="l00387"></a>00387 
<a name="l00388"></a>00388         <span class="comment">// TBD: URG currently not supported</span>
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="comment">//</span>
<a name="l00392"></a>00392     <span class="comment">// RFC 793: seventh, process the segment text,</span>
<a name="l00393"></a>00393     <span class="comment">//</span>
<a name="l00394"></a>00394     uint32 old_rcv_nxt = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>; <span class="comment">// if rcv_nxt changes, we need to send/schedule an ACK</span>
<a name="l00395"></a>00395     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>)
<a name="l00396"></a>00396     {
<a name="l00397"></a>00397         <span class="comment">//&quot;</span>
<a name="l00398"></a>00398         <span class="comment">// Once in the ESTABLISHED state, it is possible to deliver segment</span>
<a name="l00399"></a>00399         <span class="comment">// text to user RECEIVE buffers.  Text from segments can be moved</span>
<a name="l00400"></a>00400         <span class="comment">// into buffers until either the buffer is full or the segment is</span>
<a name="l00401"></a>00401         <span class="comment">// empty.  If the segment empties and carries an PUSH flag, then</span>
<a name="l00402"></a>00402         <span class="comment">// the user is informed, when the buffer is returned, that a PUSH</span>
<a name="l00403"></a>00403         <span class="comment">// has been received.</span>
<a name="l00404"></a>00404         <span class="comment">//</span>
<a name="l00405"></a>00405         <span class="comment">// When the TCP takes responsibility for delivering the data to the</span>
<a name="l00406"></a>00406         <span class="comment">// user it must also acknowledge the receipt of the data.</span>
<a name="l00407"></a>00407         <span class="comment">//</span>
<a name="l00408"></a>00408         <span class="comment">// Once the TCP takes responsibility for the data it advances</span>
<a name="l00409"></a>00409         <span class="comment">// RCV.NXT over the data accepted, and adjusts RCV.WND as</span>
<a name="l00410"></a>00410         <span class="comment">// apporopriate to the current buffer availability.  The total of</span>
<a name="l00411"></a>00411         <span class="comment">// RCV.NXT and RCV.WND should not be reduced.</span>
<a name="l00412"></a>00412         <span class="comment">//</span>
<a name="l00413"></a>00413         <span class="comment">// Please note the window management suggestions in section 3.7.</span>
<a name="l00414"></a>00414         <span class="comment">//</span>
<a name="l00415"></a>00415         <span class="comment">// Send an acknowledgment of the form:</span>
<a name="l00416"></a>00416         <span class="comment">//</span>
<a name="l00417"></a>00417         <span class="comment">//   &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
<a name="l00418"></a>00418         <span class="comment">//</span>
<a name="l00419"></a>00419         <span class="comment">// This acknowledgment should be piggybacked on a segment being</span>
<a name="l00420"></a>00420         <span class="comment">// transmitted if possible without incurring undue delay.</span>
<a name="l00421"></a>00421         <span class="comment">//&quot;</span>
<a name="l00422"></a>00422         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0)
<a name="l00423"></a>00423         {
<a name="l00424"></a>00424             <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment text in a data transfer state\n&quot;</span>;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426             <span class="comment">// insert into receive buffers. If this segment is contiguous with</span>
<a name="l00427"></a>00427             <span class="comment">// previously received ones (seqNo==rcv_nxt), rcv_nxt can be increased;</span>
<a name="l00428"></a>00428             <span class="comment">// otherwise it stays the same but the data must be cached nevertheless</span>
<a name="l00429"></a>00429             <span class="comment">// (to avoid &quot;Failure to retain above-sequence data&quot; problem, RFC 2525</span>
<a name="l00430"></a>00430             <span class="comment">// section 2.5).</span>
<a name="l00431"></a>00431             uint32 old_rcv_nxt = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>;
<a name="l00432"></a>00432             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#a28492372a4252f374ba62fbdcce7a566">insertBytesFromSegment</a>(tcpseg);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434             <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a91800c1929091c104e787a01f5955a9f">seqGreater</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>, old_snd_una))
<a name="l00435"></a>00435             {
<a name="l00436"></a>00436                 <span class="comment">// notify</span>
<a name="l00437"></a>00437                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#aca06733ab569ab16f026d31a3bfe5077">receivedDataAck</a>(old_snd_una);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439                 <span class="comment">// in the receivedDataAck we need the old value</span>
<a name="l00440"></a>00440                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74cb98612a9fa541a2682e33f3991582">dupacks</a> = 0;
<a name="l00441"></a>00441             }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443             <span class="comment">// out-of-order segment?</span>
<a name="l00444"></a>00444             <span class="keywordflow">if</span> (old_rcv_nxt==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>)
<a name="l00445"></a>00445             {
<a name="l00446"></a>00446                 <span class="comment">// we&#39;ll probably want to send an ACK here</span>
<a name="l00447"></a>00447                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a7ea3a177d38f6a05e84637233ae3b63d">receivedOutOfOrderSegment</a>();
<a name="l00448"></a>00448             }
<a name="l00449"></a>00449             <span class="keywordflow">else</span>
<a name="l00450"></a>00450             {
<a name="l00451"></a>00451                 <span class="comment">// forward data to app</span>
<a name="l00452"></a>00452                 <span class="comment">//</span>
<a name="l00453"></a>00453                 <span class="comment">// FIXME observe PSH bit</span>
<a name="l00454"></a>00454                 <span class="comment">//</span>
<a name="l00455"></a>00455                 <span class="comment">// FIXME we should implement socket READ command, and pass up only</span>
<a name="l00456"></a>00456                 <span class="comment">// as many bytes as requested. rcv_wnd should be decreased</span>
<a name="l00457"></a>00457                 <span class="comment">// accordingly! (right now we *always* advertise win=16384,</span>
<a name="l00458"></a>00458                 <span class="comment">// that is, there&#39;s practically no receiver-imposed flow control!)</span>
<a name="l00459"></a>00459                 <span class="comment">//</span>
<a name="l00460"></a>00460                 cPacket *msg;
<a name="l00461"></a>00461                 <span class="keywordflow">while</span> ((msg=<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#a8d5fa8d22c976a8be92512e11b350f9f">extractBytesUpTo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>))!=NULL)
<a name="l00462"></a>00462                 {
<a name="l00463"></a>00463                     msg-&gt;setKind(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba78bce3d41e158816c5212ed2fc959b06">TCP_I_DATA</a>);  <span class="comment">// TBD currently we never send TCP_I_URGENT_DATA</span>
<a name="l00464"></a>00464                     <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *cmd = <span class="keyword">new</span> <a class="code" href="class_t_c_p_command.html">TCPCommand</a>();
<a name="l00465"></a>00465                     cmd-&gt;<a class="code" href="class_t_c_p_command.html#a2688defdcadd3de43faae9c27748be24">setConnId</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a>);
<a name="l00466"></a>00466                     msg-&gt;setControlInfo(cmd);
<a name="l00467"></a>00467                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a>(msg);
<a name="l00468"></a>00468                 }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                 <span class="comment">// if this segment &quot;filled the gap&quot; until the previously arrived segment</span>
<a name="l00471"></a>00471                 <span class="comment">// that carried a FIN (i.e.rcv_nxt==rcv_fin_seq), we have to advance</span>
<a name="l00472"></a>00472                 <span class="comment">// rcv_nxt over the FIN.</span>
<a name="l00473"></a>00473                 <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a595ba253f26cb674ecd990bfd6d929c1">fin_rcvd</a> &amp;&amp; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4e7a46f4ab93fc16930f38b65cc5ff07">rcv_fin_seq</a>)
<a name="l00474"></a>00474                 {
<a name="l00475"></a>00475                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;All segments arrived up to the FIN segment, advancing rcv_nxt over the FIN\n&quot;</span>;
<a name="l00476"></a>00476                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4e7a46f4ab93fc16930f38b65cc5ff07">rcv_fin_seq</a>+1;
<a name="l00477"></a>00477                     <span class="comment">// state transitions will be done in the state machine, here we just set</span>
<a name="l00478"></a>00478                     <span class="comment">// the proper event code (TCP_E_RCV_FIN or TCP_E_RCV_FIN_ACK)</span>
<a name="l00479"></a>00479                     <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a59323c4bb3247640d61362e7f6ba824e">TCP_E_RCV_FIN</a>;
<a name="l00480"></a>00480                     <span class="keywordflow">switch</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00481"></a>00481                     {
<a name="l00482"></a>00482                         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>:
<a name="l00483"></a>00483                             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ad2deb1000d47f2e1524f1f5dee059b34">fin_ack_rcvd</a>)
<a name="l00484"></a>00484                             {
<a name="l00485"></a>00485                                 <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2f4afa3cc8122b708143ae335b542179">TCP_E_RCV_FIN_ACK</a>;
<a name="l00486"></a>00486                                 <span class="comment">// start the time-wait timer, turn off the other timers</span>
<a name="l00487"></a>00487                                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>);
<a name="l00488"></a>00488                                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490                                 <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00491"></a>00491                                 <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00492"></a>00492                                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00493"></a>00493                             }
<a name="l00494"></a>00494                             <span class="keywordflow">break</span>;
<a name="l00495"></a>00495                         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l00496"></a>00496                             <span class="comment">// Start the time-wait timer, turn off the other timers.</span>
<a name="l00497"></a>00497                             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>);
<a name="l00498"></a>00498                             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500                             <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00501"></a>00501                             <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00502"></a>00502                             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00503"></a>00503                             <span class="keywordflow">break</span>;
<a name="l00504"></a>00504                         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>:
<a name="l00505"></a>00505                             <span class="comment">// Restart the 2 MSL time-wait timeout.</span>
<a name="l00506"></a>00506                             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>);
<a name="l00507"></a>00507                             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00508"></a>00508                             <span class="keywordflow">break</span>;
<a name="l00509"></a>00509                     }
<a name="l00510"></a>00510                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba98ff9f82c08b1d7ae58049835c47368a">TCP_I_PEER_CLOSED</a>);
<a name="l00511"></a>00511                 }
<a name="l00512"></a>00512             }
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="comment">//</span>
<a name="l00517"></a>00517     <span class="comment">// RFC 793: eighth, check the FIN bit,</span>
<a name="l00518"></a>00518     <span class="comment">//</span>
<a name="l00519"></a>00519     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())
<a name="l00520"></a>00520     {
<a name="l00521"></a>00521         <span class="comment">//&quot;</span>
<a name="l00522"></a>00522         <span class="comment">// If the FIN bit is set, signal the user &quot;connection closing&quot; and</span>
<a name="l00523"></a>00523         <span class="comment">// return any pending RECEIVEs with same message, advance RCV.NXT</span>
<a name="l00524"></a>00524         <span class="comment">// over the FIN, and send an acknowledgment for the FIN.  Note that</span>
<a name="l00525"></a>00525         <span class="comment">// FIN implies PUSH for any segment text not yet delivered to the</span>
<a name="l00526"></a>00526         <span class="comment">// user.</span>
<a name="l00527"></a>00527         <span class="comment">//&quot;</span>
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         <span class="comment">// Note: seems like RFC 793 is not entirely correct here: if the</span>
<a name="l00530"></a>00530         <span class="comment">// segment is &quot;above sequence&quot; (ie. RCV.NXT &lt; SEG.SEQ), we cannot</span>
<a name="l00531"></a>00531         <span class="comment">// advance RCV.NXT over the FIN. Instead we remember this sequence</span>
<a name="l00532"></a>00532         <span class="comment">// number and do it later.</span>
<a name="l00533"></a>00533         uint32 fin_seq = (uint32)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() + (uint32)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>==fin_seq)
<a name="l00535"></a>00535         {
<a name="l00536"></a>00536             <span class="comment">// advance rcv_nxt over FIN now</span>
<a name="l00537"></a>00537             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN arrived, advancing rcv_nxt over the FIN\n&quot;</span>;
<a name="l00538"></a>00538             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>++;
<a name="l00539"></a>00539             <span class="comment">// state transitions will be done in the state machine, here we just set</span>
<a name="l00540"></a>00540             <span class="comment">// the proper event code (TCP_E_RCV_FIN or TCP_E_RCV_FIN_ACK)</span>
<a name="l00541"></a>00541             <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a59323c4bb3247640d61362e7f6ba824e">TCP_E_RCV_FIN</a>;
<a name="l00542"></a>00542             <span class="keywordflow">switch</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState())
<a name="l00543"></a>00543             {
<a name="l00544"></a>00544                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>:
<a name="l00545"></a>00545                     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ad2deb1000d47f2e1524f1f5dee059b34">fin_ack_rcvd</a>)
<a name="l00546"></a>00546                     {
<a name="l00547"></a>00547                         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2f4afa3cc8122b708143ae335b542179">TCP_E_RCV_FIN_ACK</a>;
<a name="l00548"></a>00548                         <span class="comment">// start the time-wait timer, turn off the other timers</span>
<a name="l00549"></a>00549                         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>);
<a name="l00550"></a>00550                         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552                         <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00553"></a>00553                         <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00554"></a>00554                         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00555"></a>00555                     }
<a name="l00556"></a>00556                     <span class="keywordflow">break</span>;
<a name="l00557"></a>00557                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l00558"></a>00558                     <span class="comment">// Start the time-wait timer, turn off the other timers.</span>
<a name="l00559"></a>00559                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>);
<a name="l00560"></a>00560                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562                     <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00563"></a>00563                     <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00564"></a>00564                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00565"></a>00565                     <span class="keywordflow">break</span>;
<a name="l00566"></a>00566                 <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>:
<a name="l00567"></a>00567                     <span class="comment">// Restart the 2 MSL time-wait timeout.</span>
<a name="l00568"></a>00568                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>);
<a name="l00569"></a>00569                     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00570"></a>00570                     <span class="keywordflow">break</span>;
<a name="l00571"></a>00571             }
<a name="l00572"></a>00572             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba98ff9f82c08b1d7ae58049835c47368a">TCP_I_PEER_CLOSED</a>);
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574         <span class="keywordflow">else</span>
<a name="l00575"></a>00575         {
<a name="l00576"></a>00576             <span class="comment">// we&#39;ll have to do it later (when an arriving segment &quot;fills the gap&quot;)</span>
<a name="l00577"></a>00577             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN segment above sequence, storing sequence number of FIN\n&quot;</span>;
<a name="l00578"></a>00578             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a595ba253f26cb674ecd990bfd6d929c1">fin_rcvd</a> = <span class="keyword">true</span>;
<a name="l00579"></a>00579             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4e7a46f4ab93fc16930f38b65cc5ff07">rcv_fin_seq</a> = fin_seq;
<a name="l00580"></a>00580         }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582         <span class="comment">// TBD do PUSH stuff</span>
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (old_rcv_nxt!=<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>)
<a name="l00586"></a>00586     {
<a name="l00587"></a>00587         <span class="comment">// if rcv_nxt changed, either because we received segment text or we</span>
<a name="l00588"></a>00588         <span class="comment">// received a FIN that needs to be acked (or both), we need to send or</span>
<a name="l00589"></a>00589         <span class="comment">// schedule an ACK.</span>
<a name="l00590"></a>00590 
<a name="l00591"></a>00591         <span class="comment">// tcpAlgorithm decides when and how to do ACKs</span>
<a name="l00592"></a>00592         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a3c59a57936e92218369a8702956df1c7">receiveSeqChanged</a>();
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="keywordflow">if</span> ((<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a> || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>) &amp;&amp;
<a name="l00596"></a>00596         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a2a8d544b5707071afcc5402e6318e245">send_fin</a> &amp;&amp; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a1156c4cdd71d0e83c9bb401a68e9f606">snd_fin_seq</a>+1)
<a name="l00597"></a>00597     {
<a name="l00598"></a>00598         <span class="comment">// if the user issued the CLOSE command a long time ago and we&#39;ve just</span>
<a name="l00599"></a>00599         <span class="comment">// managed to send off FIN, we simulate a CLOSE command now (we had to</span>
<a name="l00600"></a>00600         <span class="comment">// defer it at that time because we still had data in the send queue.)</span>
<a name="l00601"></a>00601         <span class="comment">// This CLOSE will take us into the FIN_WAIT_1 state.</span>
<a name="l00602"></a>00602         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Now we can do the CLOSE which was deferred a while ago\n&quot;</span>;
<a name="l00603"></a>00603         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>;
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">fsm</a>.getState()==<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a> &amp;&amp; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a2a8d544b5707071afcc5402e6318e245">send_fin</a> &amp;&amp;
<a name="l00607"></a>00607         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a1156c4cdd71d0e83c9bb401a68e9f606">snd_fin_seq</a>+1 &amp;&amp; old_snd_nxt!=<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>)
<a name="l00608"></a>00608     {
<a name="l00609"></a>00609         <span class="comment">// if we&#39;re in CLOSE_WAIT and we just got to sent our long-pending FIN,</span>
<a name="l00610"></a>00610         <span class="comment">// we simulate a CLOSE command now (we had to defer it at that time because</span>
<a name="l00611"></a>00611         <span class="comment">// we still had data in the send queue.) This CLOSE will take us into the</span>
<a name="l00612"></a>00612         <span class="comment">// LAST_ACK state.</span>
<a name="l00613"></a>00613         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Now we can do the CLOSE which was deferred a while ago\n&quot;</span>;
<a name="l00614"></a>00614         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a2c5c582787e0b87a4a913e34c4d20d1b">TCP_E_CLOSE</a>;
<a name="l00615"></a>00615     }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     <span class="keywordflow">return</span> event;
<a name="l00618"></a>00618 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d034577df86997140d627feeda66a1f"></a><!-- doxytag: member="tcp_old::TCPConnection::processSegmentInListen" ref="a4d034577df86997140d627feeda66a1f" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> TCPConnection::processSegmentInListen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00623"></a>00623 {
<a name="l00624"></a>00624     <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment in LISTEN\n&quot;</span>;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <span class="comment">//&quot;</span>
<a name="l00627"></a>00627     <span class="comment">// first check for an RST</span>
<a name="l00628"></a>00628     <span class="comment">//   An incoming RST should be ignored.  Return.</span>
<a name="l00629"></a>00629     <span class="comment">//&quot;</span>
<a name="l00630"></a>00630     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST bit set: dropping segment\n&quot;</span>;
<a name="l00633"></a>00633         <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     <span class="comment">//&quot;</span>
<a name="l00637"></a>00637     <span class="comment">// second check for an ACK</span>
<a name="l00638"></a>00638     <span class="comment">//    Any acknowledgment is bad if it arrives on a connection still in</span>
<a name="l00639"></a>00639     <span class="comment">//    the LISTEN state.  An acceptable reset segment should be formed</span>
<a name="l00640"></a>00640     <span class="comment">//    for any arriving ACK-bearing segment.  The RST should be</span>
<a name="l00641"></a>00641     <span class="comment">//    formatted as follows:</span>
<a name="l00642"></a>00642     <span class="comment">//</span>
<a name="l00643"></a>00643     <span class="comment">//      &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
<a name="l00644"></a>00644     <span class="comment">//</span>
<a name="l00645"></a>00645     <span class="comment">//    Return.</span>
<a name="l00646"></a>00646     <span class="comment">//&quot;</span>
<a name="l00647"></a>00647     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00648"></a>00648     {
<a name="l00649"></a>00649         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set: dropping segment and sending RST\n&quot;</span>;
<a name="l00650"></a>00650         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00651"></a>00651         <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00652"></a>00652     }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <span class="comment">//&quot;</span>
<a name="l00655"></a>00655     <span class="comment">// third check for a SYN</span>
<a name="l00656"></a>00656     <span class="comment">//&quot;</span>
<a name="l00657"></a>00657     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())
<a name="l00660"></a>00660         {
<a name="l00661"></a>00661             <span class="comment">// Looks like implementations vary on how to react to SYN+FIN.</span>
<a name="l00662"></a>00662             <span class="comment">// Some treat it as plain SYN (and reply with SYN+ACK), some send RST+ACK.</span>
<a name="l00663"></a>00663             <span class="comment">// Let&#39;s just do the former here.</span>
<a name="l00664"></a>00664             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+FIN received: ignoring FIN\n&quot;</span>;
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN bit set: filling in foreign socket and sending SYN+ACK\n&quot;</span>;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         <span class="comment">//&quot;</span>
<a name="l00670"></a>00670         <span class="comment">// If the listen was not fully specified (i.e., the foreign socket was not</span>
<a name="l00671"></a>00671         <span class="comment">// fully specified), then the unspecified fields should be filled in now.</span>
<a name="l00672"></a>00672         <span class="comment">//&quot;</span>
<a name="l00673"></a>00673         <span class="comment">//</span>
<a name="l00674"></a>00674         <span class="comment">// Also, we may need to fork, in order to leave another connection</span>
<a name="l00675"></a>00675         <span class="comment">// LISTENing on the port. Note: forking will change our connId.</span>
<a name="l00676"></a>00676         <span class="comment">//</span>
<a name="l00677"></a>00677         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4f418e2320cca13bdf3a673ae74989ac">fork</a>)
<a name="l00678"></a>00678         {
<a name="l00679"></a>00679             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html">TCPConnection</a> *conn = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection</a>(); <span class="comment">// this will stay LISTENing</span>
<a name="l00680"></a>00680             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">addForkedConnection</a>(<span class="keyword">this</span>, conn, destAddr, srcAddr, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00681"></a>00681             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Connection forked: this connection got new connId=&quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00682"></a>00682                      <span class="stringliteral">&quot;spinoff keeps LISTENing with connId=&quot;</span> &lt;&lt; conn-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684         <span class="keywordflow">else</span>
<a name="l00685"></a>00685         {
<a name="l00686"></a>00686             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">updateSockPair</a>(<span class="keyword">this</span>, destAddr, srcAddr, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689         <span class="comment">//&quot;</span>
<a name="l00690"></a>00690         <span class="comment">//  Set RCV.NXT to SEG.SEQ+1, IRS is set to SEG.SEQ and any other</span>
<a name="l00691"></a>00691         <span class="comment">//  control or text should be queued for processing later.  ISS</span>
<a name="l00692"></a>00692         <span class="comment">//  should be selected and a SYN segment sent of the form:</span>
<a name="l00693"></a>00693         <span class="comment">//</span>
<a name="l00694"></a>00694         <span class="comment">//    &lt;SEQ=ISS&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=SYN,ACK&gt;</span>
<a name="l00695"></a>00695         <span class="comment">//</span>
<a name="l00696"></a>00696         <span class="comment">//  SND.NXT is set to ISS+1 and SND.UNA to ISS.  The connection</span>
<a name="l00697"></a>00697         <span class="comment">//  state should be changed to SYN-RECEIVED.</span>
<a name="l00698"></a>00698         <span class="comment">//&quot;</span>
<a name="l00699"></a>00699         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()+1;
<a name="l00700"></a>00700         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#af9fc103c0361bcaffc4c894627abfc2d">irs</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00701"></a>00701         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#aeec7fc4688fecfdd84653b748ff1c21e">init</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>);   <span class="comment">// FIXME may init twice...</span>
<a name="l00702"></a>00702         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();
<a name="l00703"></a>00703 
<a name="l00704"></a>00704         <span class="comment">// although not mentioned in RFC 793, seems like we have to pick up</span>
<a name="l00705"></a>00705         <span class="comment">// initial snd_wnd from the segment here.</span>
<a name="l00706"></a>00706         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>();
<a name="l00707"></a>00707         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4ddf055ba61bab9723814bfb1f55cfe5">snd_wl1</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00708"></a>00708         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aae32069f7798da55852c7244d816b9a1">snd_wl2</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>;
<a name="l00709"></a>00709         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a>-&gt;record(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a>);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>();
<a name="l00712"></a>00712         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
<a name="l00713"></a>00713         <span class="keywordflow">if</span> (!<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>-&gt;isScheduled())
<a name="l00714"></a>00714             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);
<a name="l00715"></a>00715 
<a name="l00716"></a>00716         <span class="comment">//&quot;</span>
<a name="l00717"></a>00717         <span class="comment">// Note that any other incoming control or data (combined with SYN)</span>
<a name="l00718"></a>00718         <span class="comment">// will be processed in the SYN-RECEIVED state, but processing of SYN</span>
<a name="l00719"></a>00719         <span class="comment">// and ACK should not be repeated.</span>
<a name="l00720"></a>00720         <span class="comment">//&quot;</span>
<a name="l00721"></a>00721         <span class="comment">// We don&#39;t send text in SYN or SYN+ACK, but accept it. Otherwise</span>
<a name="l00722"></a>00722         <span class="comment">// there isn&#39;t much left to do: RST, SYN, ACK, FIN got processed already,</span>
<a name="l00723"></a>00723         <span class="comment">// so there&#39;s only URG and PSH left to handle.</span>
<a name="l00724"></a>00724         <span class="comment">//</span>
<a name="l00725"></a>00725         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0)
<a name="l00726"></a>00726             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#a28492372a4252f374ba62fbdcce7a566">insertBytesFromSegment</a>(tcpseg);
<a name="l00727"></a>00727         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>() || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a951517b397bea146bb642976521469d7">getPshBit</a>())
<a name="l00728"></a>00728             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN\n&quot;</span>; <span class="comment">// TBD</span>
<a name="l00729"></a>00729 
<a name="l00730"></a>00730         <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6769520e2e41d511462d3608d18326ed">TCP_E_RCV_SYN</a>;  <span class="comment">// this will take us to SYN_RCVD</span>
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     <span class="comment">//&quot;</span>
<a name="l00734"></a>00734     <span class="comment">//  fourth other text or control</span>
<a name="l00735"></a>00735     <span class="comment">//   So you are unlikely to get here, but if you do, drop the segment, and return.</span>
<a name="l00736"></a>00736     <span class="comment">//&quot;</span>
<a name="l00737"></a>00737     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected segment: dropping it\n&quot;</span>;
<a name="l00738"></a>00738     <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00739"></a>00739 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a12b903f9e148f5c26f926dcdc8107c86"></a><!-- doxytag: member="tcp_old::TCPConnection::processSegmentInSynSent" ref="a12b903f9e148f5c26f926dcdc8107c86" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32">TCPEventCode</a> TCPConnection::processSegmentInSynSent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00742"></a>00742 {
<a name="l00743"></a>00743     <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment in SYN_SENT\n&quot;</span>;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745     <span class="comment">//&quot;</span>
<a name="l00746"></a>00746     <span class="comment">// first check the ACK bit</span>
<a name="l00747"></a>00747     <span class="comment">//</span>
<a name="l00748"></a>00748     <span class="comment">//   If the ACK bit is set</span>
<a name="l00749"></a>00749     <span class="comment">//</span>
<a name="l00750"></a>00750     <span class="comment">//     If SEG.ACK =&lt; ISS, or SEG.ACK &gt; SND.NXT, send a reset (unless</span>
<a name="l00751"></a>00751     <span class="comment">//     the RST bit is set, if so drop the segment and return)</span>
<a name="l00752"></a>00752     <span class="comment">//</span>
<a name="l00753"></a>00753     <span class="comment">//       &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
<a name="l00754"></a>00754     <span class="comment">//</span>
<a name="l00755"></a>00755     <span class="comment">//     and discard the segment.  Return.</span>
<a name="l00756"></a>00756     <span class="comment">//</span>
<a name="l00757"></a>00757     <span class="comment">//     If SND.UNA =&lt; SEG.ACK =&lt; SND.NXT then the ACK is acceptable.</span>
<a name="l00758"></a>00758     <span class="comment">//&quot;</span>
<a name="l00759"></a>00759     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00760"></a>00760     {
<a name="l00761"></a>00761         <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a2a4d76c437a6e0eb1e1440c02153e5db">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>) || <a class="code" href="namespacetcp__old.html#a91800c1929091c104e787a01f5955a9f">seqGreater</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>))
<a name="l00762"></a>00762         {
<a name="l00763"></a>00763             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set but wrong AckNo, sending RST\n&quot;</span>;
<a name="l00764"></a>00764             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00765"></a>00765             <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00766"></a>00766         }
<a name="l00767"></a>00767         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set, AckNo acceptable\n&quot;</span>;
<a name="l00768"></a>00768     }
<a name="l00769"></a>00769 
<a name="l00770"></a>00770     <span class="comment">//&quot;</span>
<a name="l00771"></a>00771     <span class="comment">// second check the RST bit</span>
<a name="l00772"></a>00772     <span class="comment">//</span>
<a name="l00773"></a>00773     <span class="comment">//   If the RST bit is set</span>
<a name="l00774"></a>00774     <span class="comment">//</span>
<a name="l00775"></a>00775     <span class="comment">//     If the ACK was acceptable then signal the user &quot;error:</span>
<a name="l00776"></a>00776     <span class="comment">//     connection reset&quot;, drop the segment, enter CLOSED state,</span>
<a name="l00777"></a>00777     <span class="comment">//     delete TCB, and return.  Otherwise (no ACK) drop the segment</span>
<a name="l00778"></a>00778     <span class="comment">//     and return.</span>
<a name="l00779"></a>00779     <span class="comment">//&quot;</span>
<a name="l00780"></a>00780     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00781"></a>00781     {
<a name="l00782"></a>00782         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00783"></a>00783         {
<a name="l00784"></a>00784             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST+ACK: performing connection reset\n&quot;</span>;
<a name="l00785"></a>00785             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba4e8f4551a34a27e607201754b36fdbe0">TCP_I_CONNECTION_RESET</a>);
<a name="l00786"></a>00786             <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a050c79add513afca8554e29b61fd5389">TCP_E_RCV_RST</a>;
<a name="l00787"></a>00787         }
<a name="l00788"></a>00788         <span class="keywordflow">else</span>
<a name="l00789"></a>00789         {
<a name="l00790"></a>00790             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST without ACK: dropping segment\n&quot;</span>;
<a name="l00791"></a>00791             <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00792"></a>00792         }
<a name="l00793"></a>00793     }
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     <span class="comment">//&quot;</span>
<a name="l00796"></a>00796     <span class="comment">// third check the security and precedence -- not done</span>
<a name="l00797"></a>00797     <span class="comment">//</span>
<a name="l00798"></a>00798     <span class="comment">// fourth check the SYN bit</span>
<a name="l00799"></a>00799     <span class="comment">//</span>
<a name="l00800"></a>00800     <span class="comment">//   This step should be reached only if the ACK is ok, or there is</span>
<a name="l00801"></a>00801     <span class="comment">//   no ACK, and it the segment did not contain a RST.</span>
<a name="l00802"></a>00802     <span class="comment">//</span>
<a name="l00803"></a>00803     <span class="comment">//   If the SYN bit is on and the security/compartment and precedence</span>
<a name="l00804"></a>00804     <span class="comment">//   are acceptable then,</span>
<a name="l00805"></a>00805     <span class="comment">//&quot;</span>
<a name="l00806"></a>00806     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00807"></a>00807     {
<a name="l00808"></a>00808         <span class="comment">//</span>
<a name="l00809"></a>00809         <span class="comment">//   RCV.NXT is set to SEG.SEQ+1, IRS is set to</span>
<a name="l00810"></a>00810         <span class="comment">//   SEG.SEQ.  SND.UNA should be advanced to equal SEG.ACK (if there</span>
<a name="l00811"></a>00811         <span class="comment">//   is an ACK), and any segments on the retransmission queue which</span>
<a name="l00812"></a>00812         <span class="comment">//   are thereby acknowledged should be removed.</span>
<a name="l00813"></a>00813         <span class="comment">//</span>
<a name="l00814"></a>00814         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()+1;
<a name="l00815"></a>00815         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#af9fc103c0361bcaffc4c894627abfc2d">irs</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00816"></a>00816         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#aeec7fc4688fecfdd84653b748ff1c21e">init</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00819"></a>00819         {
<a name="l00820"></a>00820             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>();
<a name="l00821"></a>00821             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#aced2fde7fde0ec8f6a32b1e16d6bbda9">discardUpTo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823             <span class="comment">// although not mentioned in RFC 793, seems like we have to pick up</span>
<a name="l00824"></a>00824             <span class="comment">// initial snd_wnd from the segment here.</span>
<a name="l00825"></a>00825             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>();
<a name="l00826"></a>00826             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a4ddf055ba61bab9723814bfb1f55cfe5">snd_wl1</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00827"></a>00827             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aae32069f7798da55852c7244d816b9a1">snd_wl2</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>();
<a name="l00828"></a>00828             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">sndWndVector</a>-&gt;record(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a>);
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="comment">// this also seems to be a good time to learn our local IP address</span>
<a name="l00832"></a>00832         <span class="comment">// (was probably unspecified at connection open)</span>
<a name="l00833"></a>00833         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">updateSockPair</a>(<span class="keyword">this</span>, destAddr, srcAddr, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00834"></a>00834 
<a name="l00835"></a>00835         <span class="comment">//&quot;</span>
<a name="l00836"></a>00836         <span class="comment">//   If SND.UNA &gt; ISS (our SYN has been ACKed), change the connection</span>
<a name="l00837"></a>00837         <span class="comment">//   state to ESTABLISHED, form an ACK segment</span>
<a name="l00838"></a>00838         <span class="comment">//</span>
<a name="l00839"></a>00839         <span class="comment">//     &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
<a name="l00840"></a>00840         <span class="comment">//</span>
<a name="l00841"></a>00841         <span class="comment">//   and send it.  Data or controls which were queued for</span>
<a name="l00842"></a>00842         <span class="comment">//   transmission may be included.  If there are other controls or</span>
<a name="l00843"></a>00843         <span class="comment">//   text in the segment then continue processing at the sixth step</span>
<a name="l00844"></a>00844         <span class="comment">//   below where the URG bit is checked, otherwise return.</span>
<a name="l00845"></a>00845         <span class="comment">//&quot;</span>
<a name="l00846"></a>00846         <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a91800c1929091c104e787a01f5955a9f">seqGreater</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>))
<a name="l00847"></a>00847         {
<a name="l00848"></a>00848             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+ACK bits set, connection established.\n&quot;</span>;
<a name="l00849"></a>00849 
<a name="l00850"></a>00850             <span class="comment">// RFC says &quot;continue processing at the sixth step below where</span>
<a name="l00851"></a>00851             <span class="comment">// the URG bit is checked&quot;. Those steps deal with: URG, segment text</span>
<a name="l00852"></a>00852             <span class="comment">// (and PSH), and FIN.</span>
<a name="l00853"></a>00853             <span class="comment">// Now: URG and PSH we don&#39;t support yet; in SYN+FIN we ignore FIN;</span>
<a name="l00854"></a>00854             <span class="comment">// with segment text we just take it easy and put it in the receiveQueue</span>
<a name="l00855"></a>00855             <span class="comment">// -- we&#39;ll forward it to the user when more data arrives.</span>
<a name="l00856"></a>00856             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())
<a name="l00857"></a>00857                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+ACK+FIN received: ignoring FIN\n&quot;</span>;
<a name="l00858"></a>00858             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0)
<a name="l00859"></a>00859                 <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#a28492372a4252f374ba62fbdcce7a566">insertBytesFromSegment</a>(tcpseg); <span class="comment">// TBD forward to app, etc.</span>
<a name="l00860"></a>00860             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>() || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a951517b397bea146bb642976521469d7">getPshBit</a>())
<a name="l00861"></a>00861                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN+ACK\n&quot;</span>; <span class="comment">// TBD</span>
<a name="l00862"></a>00862 
<a name="l00863"></a>00863             <span class="comment">// notify tcpAlgorithm (it has to send ACK of SYN) and app layer</span>
<a name="l00864"></a>00864             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a6bbeaec803a6c9e148ba36c838c267a5">established</a>(<span class="keyword">true</span>);
<a name="l00865"></a>00865             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a>();
<a name="l00866"></a>00866 
<a name="l00867"></a>00867             <span class="comment">// This will trigger transition to ESTABLISHED. Timers and notifying</span>
<a name="l00868"></a>00868             <span class="comment">// app will be taken care of in stateEntered().</span>
<a name="l00869"></a>00869             <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a3239eea5ba6edf6850289914cfac51c8">TCP_E_RCV_SYN_ACK</a>;
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872         <span class="comment">//&quot;</span>
<a name="l00873"></a>00873         <span class="comment">//   Otherwise enter SYN-RECEIVED, form a SYN,ACK segment</span>
<a name="l00874"></a>00874         <span class="comment">//</span>
<a name="l00875"></a>00875         <span class="comment">//     &lt;SEQ=ISS&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=SYN,ACK&gt;</span>
<a name="l00876"></a>00876         <span class="comment">//</span>
<a name="l00877"></a>00877         <span class="comment">//   and send it.  If there are other controls or text in the</span>
<a name="l00878"></a>00878         <span class="comment">//   segment, queue them for processing after the ESTABLISHED state</span>
<a name="l00879"></a>00879         <span class="comment">//   has been reached, return.</span>
<a name="l00880"></a>00880         <span class="comment">//&quot;</span>
<a name="l00881"></a>00881         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN bit set: sending SYN+ACK\n&quot;</span>;
<a name="l00882"></a>00882         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>;
<a name="l00883"></a>00883         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>();
<a name="l00884"></a>00884         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
<a name="l00885"></a>00885 
<a name="l00886"></a>00886         <span class="comment">// Note: code below is similar to processing SYN in LISTEN.</span>
<a name="l00887"></a>00887 
<a name="l00888"></a>00888         <span class="comment">// For consistency with that code, we ignore SYN+FIN here</span>
<a name="l00889"></a>00889         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())
<a name="l00890"></a>00890             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+FIN received: ignoring FIN\n&quot;</span>;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892         <span class="comment">// We don&#39;t send text in SYN or SYN+ACK, but accept it. Otherwise</span>
<a name="l00893"></a>00893         <span class="comment">// there isn&#39;t much left to do: RST, SYN, ACK, FIN got processed already,</span>
<a name="l00894"></a>00894         <span class="comment">// so there&#39;s only URG and PSH left to handle.</span>
<a name="l00895"></a>00895         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0)
<a name="l00896"></a>00896             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">receiveQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_receive_queue.html#a28492372a4252f374ba62fbdcce7a566">insertBytesFromSegment</a>(tcpseg);
<a name="l00897"></a>00897         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>() || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a951517b397bea146bb642976521469d7">getPshBit</a>())
<a name="l00898"></a>00898             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN\n&quot;</span>; <span class="comment">// TBD</span>
<a name="l00899"></a>00899         <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6769520e2e41d511462d3608d18326ed">TCP_E_RCV_SYN</a>;
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901 
<a name="l00902"></a>00902     <span class="comment">//&quot;</span>
<a name="l00903"></a>00903     <span class="comment">// fifth, if neither of the SYN or RST bits is set then drop the</span>
<a name="l00904"></a>00904     <span class="comment">// segment and return.</span>
<a name="l00905"></a>00905     <span class="comment">//&quot;</span>
<a name="l00906"></a>00906     <span class="keywordflow">return</span> <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00907"></a>00907 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7f5f8ddb99114615c77fe0ccf16424e7"></a><!-- doxytag: member="tcp_old::TCPConnection::processTCPSegment" ref="a7f5f8ddb99114615c77fe0ccf16424e7" args="(TCPSegment *tcpSeg, IPvXAddress srcAddr, IPvXAddress destAddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processTCPSegment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpSeg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>srcAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>destAddr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process incoming <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> segment. Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a>). </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00084">tcp_old::TCP::handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00222"></a>00222 {
<a name="l00223"></a>00223     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();
<a name="l00224"></a>00224     <span class="keywordflow">if</span> (!<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>())
<a name="l00225"></a>00225     {
<a name="l00226"></a>00226         ASSERT(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>==segDestAddr);
<a name="l00227"></a>00227         ASSERT(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>==tcpseg-&gt;getDestPort());
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229     <span class="keywordflow">if</span> (!<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>())
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231         ASSERT(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>==segSrcAddr);
<a name="l00232"></a>00232         ASSERT(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a>==tcpseg-&gt;getSrcPort());
<a name="l00233"></a>00233     }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a9b7d3f811eab0367d3826dfb20c8d931">tryFastRoute</a>(tcpseg))
<a name="l00236"></a>00236         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="comment">// first do actions</span>
<a name="l00239"></a>00239     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT</a>(tcpseg, segSrcAddr, segDestAddr);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="comment">// then state transitions</span>
<a name="l00242"></a>00242     <span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
<a name="l00243"></a>00243 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6f9e1e7a0cabaf710f2d37a19eea0caf"></a><!-- doxytag: member="tcp_old::TCPConnection::processTimer" ref="a6f9e1e7a0cabaf710f2d37a19eea0caf" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processTimer </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process self-messages (timers). Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a>). </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00084">tcp_old::TCP::handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00185"></a>00185 {
<a name="l00186"></a>00186     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();
<a name="l00187"></a>00187     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; msg-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; timer expired\n&quot;</span>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="comment">// first do actions</span>
<a name="l00190"></a>00190     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> event;
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (msg==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>)
<a name="l00192"></a>00192     {
<a name="l00193"></a>00193         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a358c0a11572a1131e318543e4b64764a">TCP_E_TIMEOUT_2MSL</a>;
<a name="l00194"></a>00194         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae29072ef963e593c4c3053827ebbec6e">process_TIMEOUT_2MSL</a>();
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>)
<a name="l00197"></a>00197     {
<a name="l00198"></a>00198         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a6ba25d81f0bcad8dbc3f1f59ce2f08ed">TCP_E_TIMEOUT_CONN_ESTAB</a>;
<a name="l00199"></a>00199         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB</a>();
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>)
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32a3d31d30a7eca2a0655da0b2c16df9500">TCP_E_TIMEOUT_FIN_WAIT_2</a>;
<a name="l00204"></a>00204         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2</a>();
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>)
<a name="l00207"></a>00207     {
<a name="l00208"></a>00208         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00209"></a>00209         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT</a>(event);
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     <span class="keywordflow">else</span>
<a name="l00212"></a>00212     {
<a name="l00213"></a>00213         <span class="keyword">event</span> = <a class="code" href="namespacetcp__old.html#abfa4f59944c07369d42e86a72040dd32acd405552b4f4c9973d5d5b7e8aae88f5">TCP_E_IGNORE</a>;
<a name="l00214"></a>00214         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a1139760efe38d49068564ab562e5c1f0">processTimer</a>(msg, event);
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="comment">// then state transitions</span>
<a name="l00218"></a>00218     <span class="keywordflow">return</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
<a name="l00219"></a>00219 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab2c57b0ff79eb111ca6840b8d7003b04"></a><!-- doxytag: member="tcp_old::TCPConnection::retransmitData" ref="ab2c57b0ff79eb111ca6840b8d7003b04" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::retransmitData </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: retransmit all from snd_una to snd_max </p>

<p>Referenced by <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00066">tcp_old::DumbTCP::processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00624"></a>00624 {
<a name="l00625"></a>00625     <span class="comment">// retransmit everything from snd_una</span>
<a name="l00626"></a>00626     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     uint32 bytesToSend = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> - <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>;
<a name="l00629"></a>00629     ASSERT(bytesToSend!=0);
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="comment">// TBD - avoid to send more than allowed - check cwnd and rwnd before retransmitting data!</span>
<a name="l00632"></a>00632     <span class="keywordflow">while</span> (bytesToSend&gt;0)
<a name="l00633"></a>00633     {
<a name="l00634"></a>00634         uint32 bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytesToSend, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a>);
<a name="l00635"></a>00635         bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytes, (uint32)(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#acf03e0bbf6565ae7df7afa656d97ca18">getBytesAvailable</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>)));
<a name="l00636"></a>00636         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
<a name="l00637"></a>00637         <span class="comment">// Do not send packets after the FIN.</span>
<a name="l00638"></a>00638         <span class="comment">// fixes bug that occurs in examples/inet/bulktransfer at event #64043  T=13.861159213744</span>
<a name="l00639"></a>00639         <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a2a8d544b5707071afcc5402e6318e245">send_fin</a> &amp;&amp; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a1156c4cdd71d0e83c9bb401a68e9f606">snd_fin_seq</a>+1)
<a name="l00640"></a>00640             <span class="keywordflow">break</span>;
<a name="l00641"></a>00641         bytesToSend -= bytes;
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8ae68910942bd1ea6558ae7849ae22ea"></a><!-- doxytag: member="tcp_old::TCPConnection::retransmitOneSegment" ref="a8ae68910942bd1ea6558ae7849ae22ea" args="(bool called_at_rto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::retransmitOneSegment </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>called_at_rto</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: retransmit one segment from snd_una </p>

<p>Referenced by <a class="el" href="old_2flavours_2_t_c_p_tahoe_8cc_source.html#l00041">tcp_old::TCPTahoe::processRexmitTimer()</a>, <a class="el" href="old_2flavours_2_t_c_p_reno_8cc_source.html#l00041">tcp_old::TCPReno::processRexmitTimer()</a>, <a class="el" href="old_2flavours_2_t_c_p_no_congestion_control_8cc_source.html#l00038">tcp_old::TCPNoCongestionControl::processRexmitTimer()</a>, <a class="el" href="old_2flavours_2_t_c_p_tahoe_8cc_source.html#l00111">tcp_old::TCPTahoe::receivedDuplicateAck()</a>, and <a class="el" href="old_2flavours_2_t_c_p_reno_8cc_source.html#l00130">tcp_old::TCPReno::receivedDuplicateAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00603"></a>00603 {
<a name="l00604"></a>00604     <span class="comment">// retransmit one segment at snd_una, and set snd_nxt accordingly (if not called at RTO)</span>
<a name="l00605"></a>00605     uint32 old_snd_nxt = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> - <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>);
<a name="l00610"></a>00610     ASSERT(bytes!=0);
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="keywordflow">if</span> (!called_at_rto)
<a name="l00615"></a>00615     {
<a name="l00616"></a>00616         <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a91800c1929091c104e787a01f5955a9f">seqGreater</a>(old_snd_nxt, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>))
<a name="l00617"></a>00617             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = old_snd_nxt;
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619     <span class="comment">// notify</span>
<a name="l00620"></a>00620     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a522fdc8f478a358787e1a21a543532e2">ackSent</a>();
<a name="l00621"></a>00621 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae1ff44c73d20293a446adc091842bedd"></a><!-- doxytag: member="tcp_old::TCPConnection::scheduleTimeout" ref="ae1ff44c73d20293a446adc091842bedd" args="(cMessage *msg, simtime_t timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcp_old::TCPConnection::scheduleTimeout </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: start a timer </p>

<p>Referenced by <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00117">tcp_old::DumbTCP::dataSent()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01125">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00179">tcp_old::TCPBaseAlg::processRexmitTimer()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00066">tcp_old::DumbTCP::processTimer()</a>, <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00329">tcp_old::TCPBaseAlg::receiveSeqChanged()</a>, <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00245">tcp_old::TCPBaseAlg::startRexmitTimer()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01115">startSynRexmitTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00421"></a>00421         {<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;scheduleAt(simTime()+timeout, msg);}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a82f6b7680530f0f784e9d8efa78fa5a5"></a><!-- doxytag: member="tcp_old::TCPConnection::segmentArrivalWhileClosed" ref="a82f6b7680530f0f784e9d8efa78fa5a5" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::segmentArrivalWhileClosed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This method gets invoked from <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> when a segment arrives which doesn't belong to an existing connection. <a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a> creates a temporary connection object so that it can call this method, then immediately deletes it. </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00175">tcp_old::TCP::segmentArrivalWhileClosed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00038"></a>00038 {
<a name="l00039"></a>00039     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Seg arrived: &quot;</span>;
<a name="l00040"></a>00040     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     <span class="comment">// This segment doesn&#39;t belong to any connection, so this object</span>
<a name="l00043"></a>00043     <span class="comment">// must be a temp object created solely for the purpose of calling us</span>
<a name="l00044"></a>00044     ASSERT(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>==NULL);
<a name="l00045"></a>00045     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Segment doesn&#39;t belong to any existing connection\n&quot;</span>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047     <span class="comment">// RFC 793:</span>
<a name="l00048"></a>00048     <span class="comment">//&quot;</span>
<a name="l00049"></a>00049     <span class="comment">// all data in the incoming segment is discarded.  An incoming</span>
<a name="l00050"></a>00050     <span class="comment">// segment containing a RST is discarded.  An incoming segment not</span>
<a name="l00051"></a>00051     <span class="comment">// containing a RST causes a RST to be sent in response.  The</span>
<a name="l00052"></a>00052     <span class="comment">// acknowledgment and sequence field values are selected to make the</span>
<a name="l00053"></a>00053     <span class="comment">// reset sequence acceptable to the TCP that sent the offending</span>
<a name="l00054"></a>00054     <span class="comment">// segment.</span>
<a name="l00055"></a>00055     <span class="comment">//</span>
<a name="l00056"></a>00056     <span class="comment">// If the ACK bit is off, sequence number zero is used,</span>
<a name="l00057"></a>00057     <span class="comment">//</span>
<a name="l00058"></a>00058     <span class="comment">//    &lt;SEQ=0&gt;&lt;ACK=SEG.SEQ+SEG.LEN&gt;&lt;CTL=RST,ACK&gt;</span>
<a name="l00059"></a>00059     <span class="comment">//</span>
<a name="l00060"></a>00060     <span class="comment">// If the ACK bit is on,</span>
<a name="l00061"></a>00061     <span class="comment">//</span>
<a name="l00062"></a>00062     <span class="comment">//    &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
<a name="l00063"></a>00063     <span class="comment">//&quot;</span>
<a name="l00064"></a>00064     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST bit set: dropping segment\n&quot;</span>;
<a name="l00067"></a>00067         <span class="keywordflow">return</span>;
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="keywordflow">if</span> (!tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00071"></a>00071     {
<a name="l00072"></a>00072         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit not set: sending RST+ACK\n&quot;</span>;
<a name="l00073"></a>00073         uint32 ackNo = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() + (uint32)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00074"></a>00074         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck</a>(0,ackNo,destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076     <span class="keywordflow">else</span>
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set: sending RST\n&quot;</span>;
<a name="l00079"></a>00079         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a585bbcdd70565eb01b6bfe17a1487c78"></a><!-- doxytag: member="tcp_old::TCPConnection::selectInitialSeqNum" ref="a585bbcdd70565eb01b6bfe17a1487c78" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::selectInitialSeqNum </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: generates ISS and initializes corresponding state variables </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00321"></a>00321 {
<a name="l00322"></a>00322     <span class="comment">// set the initial send sequence number</span>
<a name="l00323"></a>00323     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a> = (<span class="keywordtype">unsigned</span> long)fmod(SIMTIME_DBL(simTime())*250000.0, 1.0+(double)(<span class="keywordtype">unsigned</span>)0xffffffffUL) &amp; 0xffffffffUL;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#ace918ba2cb215baffc2c3136e35a0d16">init</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>+1); <span class="comment">// +1 is for SYN</span>
<a name="l00328"></a>00328 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a60ee5bc5b391d621e7e684857e195151"></a><!-- doxytag: member="tcp_old::TCPConnection::sendAck" ref="a60ee5bc5b391d621e7e684857e195151" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendAck </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send ACK </p>

<p>Referenced by <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00141">tcp_old::TCPBaseAlg::established()</a>, <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00050">tcp_old::DumbTCP::established()</a>, <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00235">tcp_old::TCPBaseAlg::processDelayedAckTimer()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00419">tcp_old::TCPBaseAlg::receivedAckForDataNotYetSent()</a>, <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00107">tcp_old::DumbTCP::receivedAckForDataNotYetSent()</a>, <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00323">tcp_old::TCPBaseAlg::receivedOutOfOrderSegment()</a>, <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00081">tcp_old::DumbTCP::receivedOutOfOrderSegment()</a>, <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00329">tcp_old::TCPBaseAlg::receiveSeqChanged()</a>, and <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00087">tcp_old::DumbTCP::receiveSeqChanged()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00415"></a>00415 {
<a name="l00416"></a>00416     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;ACK&quot;</span>);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00419"></a>00419     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>);
<a name="l00420"></a>00420     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>);
<a name="l00421"></a>00421     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ab26a1e5c5f13a245ef7578dc87e81cfe">rcv_wnd</a>);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="comment">// send it</span>
<a name="l00424"></a>00424     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     <span class="comment">// notify</span>
<a name="l00427"></a>00427     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a522fdc8f478a358787e1a21a543532e2">ackSent</a>();
<a name="l00428"></a>00428 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab2cbccc16b2f006369a83c51426e4bc5"></a><!-- doxytag: member="tcp_old::TCPConnection::sendData" ref="ab2cbccc16b2f006369a83c51426e4bc5" args="(bool fullSegmentsOnly, int congestionWindow=&#45;1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::sendData </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>fullSegmentsOnly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>congestionWindow</em> = <code>-1</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: Send data from sendQueue, at most congestionWindow (-1 means no limit). FIXME adjust comment!!! If fullSegmentsOnly is set, don't send segments smaller than MSS (needed for Nagle). Returns true if some data was actually sent. </p>

<p>Referenced by <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00050">tcp_old::DumbTCP::established()</a>, <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00095">tcp_old::DumbTCP::receivedDataAck()</a>, <a class="el" href="old_2flavours_2_dumb_t_c_p_8cc_source.html#l00075">tcp_old::DumbTCP::sendCommandInvoked()</a>, and <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00294">tcp_old::TCPBaseAlg::sendData()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00481"></a>00481 {
<a name="l00482"></a>00482     <span class="keywordflow">if</span> (!<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a3a3438ec884f8d063558f87d793c1fee">afterRto</a>)
<a name="l00483"></a>00483     {
<a name="l00484"></a>00484         <span class="comment">// we&#39;ll start sending from snd_max</span>
<a name="l00485"></a>00485         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>;
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <span class="comment">// check how many bytes we have</span>
<a name="l00489"></a>00489     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#acf03e0bbf6565ae7df7afa656d97ca18">getBytesAvailable</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>);
<a name="l00490"></a>00490     <span class="keywordflow">if</span> (buffered==0)
<a name="l00491"></a>00491         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="comment">// maxWindow is smaller of (snd_wnd, congestionWindow)</span>
<a name="l00494"></a>00494     <span class="keywordtype">long</span> maxWindow = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a>;
<a name="l00495"></a>00495     <span class="keywordflow">if</span> (congestionWindow&gt;=0 &amp;&amp; maxWindow &gt; congestionWindow)
<a name="l00496"></a>00496         maxWindow = congestionWindow;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="comment">// effectiveWindow: number of bytes we&#39;re allowed to send now</span>
<a name="l00499"></a>00499     <span class="keywordtype">long</span> effectiveWin = maxWindow - (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> - <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>);
<a name="l00500"></a>00500     <span class="keywordflow">if</span> (effectiveWin &lt;= 0)
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Effective window is zero (advertised window &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a98ce75b56709cdf80549bf95b9b02023">snd_wnd</a> &lt;&lt;
<a name="l00503"></a>00503                  <span class="stringliteral">&quot;, congestion window &quot;</span> &lt;&lt; congestionWindow &lt;&lt; <span class="stringliteral">&quot;), cannot send.\n&quot;</span>;
<a name="l00504"></a>00504         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytesToSend = effectiveWin;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="keywordflow">if</span> (bytesToSend &gt; buffered)
<a name="l00510"></a>00510         bytesToSend = buffered;
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     <span class="keywordflow">if</span> (fullSegmentsOnly &amp;&amp; bytesToSend &lt; state-&gt;snd_mss &amp;&amp; buffered &gt; (<a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) effectiveWin) <span class="comment">// last segment could be less than state-&gt;snd_mss</span>
<a name="l00513"></a>00513     {
<a name="l00514"></a>00514         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Cannot send, not enough data for a full segment (SMSS=&quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a>
<a name="l00515"></a>00515             &lt;&lt; <span class="stringliteral">&quot;, in buffer &quot;</span> &lt;&lt; buffered &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00516"></a>00516         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00517"></a>00517     }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="comment">// start sending &#39;bytesToSend&#39; bytes</span>
<a name="l00520"></a>00520     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Will send &quot;</span> &lt;&lt; bytesToSend &lt;&lt; <span class="stringliteral">&quot; bytes (effectiveWindow &quot;</span> &lt;&lt; effectiveWin
<a name="l00521"></a>00521         &lt;&lt; <span class="stringliteral">&quot;, in buffer &quot;</span> &lt;&lt; buffered &lt;&lt; <span class="stringliteral">&quot; bytes)\n&quot;</span>;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     uint32 old_snd_nxt = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>;
<a name="l00524"></a>00524     ASSERT(bytesToSend&gt;0);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="preprocessor">#ifdef TCP_SENDFRAGMENTS  </span><span class="comment">/* normally undefined */</span>
<a name="l00527"></a>00527     <span class="comment">// make agressive use of the window until the last byte</span>
<a name="l00528"></a>00528     <span class="keywordflow">while</span> (bytesToSend&gt;0)
<a name="l00529"></a>00529     {
<a name="l00530"></a>00530         <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytesToSend, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a>);
<a name="l00531"></a>00531         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
<a name="l00532"></a>00532         bytesToSend -= bytes;
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534 <span class="preprocessor">#else</span>
<a name="l00535"></a>00535 <span class="preprocessor"></span>    <span class="comment">// send &lt;MSS segments only if it&#39;s the only segment we can send now</span>
<a name="l00536"></a>00536     <span class="comment">// FIXME this should probably obey Nagle&#39;s alg -- to be checked</span>
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (bytesToSend &lt;= state-&gt;snd_mss)
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytesToSend);
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541     <span class="keywordflow">else</span>
<a name="l00542"></a>00542     {
<a name="l00543"></a>00543         <span class="comment">// send whole segments only (nagle_enabled)</span>
<a name="l00544"></a>00544         <span class="keywordflow">while</span> (bytesToSend&gt;=<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a>)
<a name="l00545"></a>00545         {
<a name="l00546"></a>00546             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a>);
<a name="l00547"></a>00547             bytesToSend -= <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#aa63003ec3568a869469e95d848e836b7">snd_mss</a>;
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549         <span class="comment">// check how many bytes we have - last segment could be less than state-&gt;snd_mss</span>
<a name="l00550"></a>00550         buffered = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#acf03e0bbf6565ae7df7afa656d97ca18">getBytesAvailable</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>);
<a name="l00551"></a>00551         <span class="keywordflow">if</span> (bytesToSend==buffered &amp;&amp; buffered!=0) <span class="comment">// last segment?</span>
<a name="l00552"></a>00552             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytesToSend);
<a name="l00553"></a>00553         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytesToSend&gt;0)
<a name="l00554"></a>00554             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; bytesToSend &lt;&lt; <span class="stringliteral">&quot; bytes of space left in effectiveWindow\n&quot;</span>;
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556 <span class="preprocessor">#endif</span>
<a name="l00557"></a>00557 <span class="preprocessor"></span>
<a name="l00558"></a>00558     <span class="comment">// remember highest seq sent (snd_nxt may be set back on retransmission,</span>
<a name="l00559"></a>00559     <span class="comment">// but we&#39;ll need snd_max to check validity of ACKs -- they must ack</span>
<a name="l00560"></a>00560     <span class="comment">// something we really sent)</span>
<a name="l00561"></a>00561     <span class="keywordflow">if</span> (<a class="code" href="namespacetcp__old.html#a91800c1929091c104e787a01f5955a9f">seqGreater</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>))
<a name="l00562"></a>00562         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>;
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>-&gt;record(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> - <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>);
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     <span class="comment">// notify (once is enough)</span>
<a name="l00566"></a>00566     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a522fdc8f478a358787e1a21a543532e2">ackSent</a>();
<a name="l00567"></a>00567     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a2a8e9ea9d181d94d837c4ca41d38627b">dataSent</a>(old_snd_nxt);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00570"></a>00570 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab04a91abde05d21293c30a78ab968eef"></a><!-- doxytag: member="tcp_old::TCPConnection::sendEstabIndicationToApp" ref="ab04a91abde05d21293c30a78ab968eef" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendEstabIndicationToApp </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends TCP_I_ESTABLISHED indication with <a class="el" href="class_t_c_p_connect_info.html">TCPConnectInfo</a> to application </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00262"></a>00262 {
<a name="l00263"></a>00263     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Notifying app: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba778d635f284e560631e2b6ce594e3323">TCP_I_ESTABLISHED</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00264"></a>00264     cMessage *msg = <span class="keyword">new</span> cMessage(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba778d635f284e560631e2b6ce594e3323">TCP_I_ESTABLISHED</a>));
<a name="l00265"></a>00265     msg-&gt;setKind(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba778d635f284e560631e2b6ce594e3323">TCP_I_ESTABLISHED</a>);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <a class="code" href="class_t_c_p_connect_info.html">TCPConnectInfo</a> *ind = <span class="keyword">new</span> <a class="code" href="class_t_c_p_connect_info.html">TCPConnectInfo</a>();
<a name="l00268"></a>00268     ind-&gt;<a class="code" href="class_t_c_p_command.html#a2688defdcadd3de43faae9c27748be24">setConnId</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a>);
<a name="l00269"></a>00269     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#acc0fe754ff51cf7adb6987197ce84113">setLocalAddr</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>);
<a name="l00270"></a>00270     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#a520c2434de5accebe56bb77c8aadd100">setRemoteAddr</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>);
<a name="l00271"></a>00271     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#aae1dc0aaa74c6cd2ff8519c65713b6c1">setLocalPort</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>);
<a name="l00272"></a>00272     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#a14416c97565e1f500549bce0d64f3563">setRemotePort</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a>);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     msg-&gt;setControlInfo(ind);
<a name="l00275"></a>00275     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">appGateIndex</a>);
<a name="l00276"></a>00276 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a70acf513d8461c73bfd06037036b1682"></a><!-- doxytag: member="tcp_old::TCPConnection::sendFin" ref="a70acf513d8461c73bfd06037036b1682" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendFin </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends FIN </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00161">process_CLOSE()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00431"></a>00431 {
<a name="l00432"></a>00432     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;FIN&quot;</span>);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <span class="comment">// Note: ACK bit *must* be set for both FIN and FIN+ACK. What makes</span>
<a name="l00435"></a>00435     <span class="comment">// the difference for FIN+ACK is that its ackNo acks the remote TCP&#39;s FIN.</span>
<a name="l00436"></a>00436     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a626c808550da11fa9ea1bdce32409784">setFinBit</a>(<span class="keyword">true</span>);
<a name="l00437"></a>00437     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00438"></a>00438     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>);
<a name="l00439"></a>00439     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>);
<a name="l00440"></a>00440     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ab26a1e5c5f13a245ef7578dc87e81cfe">rcv_wnd</a>);
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     <span class="comment">// send it</span>
<a name="l00443"></a>00443     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     <span class="comment">// notify</span>
<a name="l00446"></a>00446     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a522fdc8f478a358787e1a21a543532e2">ackSent</a>();
<a name="l00447"></a>00447 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a65a8dc93c08a685f145248d0fb327428"></a><!-- doxytag: member="tcp_old::TCPConnection::sendIndicationToApp" ref="a65a8dc93c08a685f145248d0fb327428" args="(int code)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendIndicationToApp </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>code</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends status indication (TCP_I_xxx) to application </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01059">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01100">process_TIMEOUT_FIN_WAIT_2()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00909">processRstInSynReceived()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>, and <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00245">signalConnectionTimeout()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00251"></a>00251 {
<a name="l00252"></a>00252     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Notifying app: &quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(code) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00253"></a>00253     cMessage *msg = <span class="keyword">new</span> cMessage(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(code));
<a name="l00254"></a>00254     msg-&gt;setKind(code);
<a name="l00255"></a>00255     <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *ind = <span class="keyword">new</span> <a class="code" href="class_t_c_p_command.html">TCPCommand</a>();
<a name="l00256"></a>00256     ind-&gt;<a class="code" href="class_t_c_p_command.html#a2688defdcadd3de43faae9c27748be24">setConnId</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">connId</a>);
<a name="l00257"></a>00257     msg-&gt;setControlInfo(ind);
<a name="l00258"></a>00258     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">appGateIndex</a>);
<a name="l00259"></a>00259 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab07a8b0ce79c80e9baf75c3e82f56937"></a><!-- doxytag: member="tcp_old::TCPConnection::sendProbe" ref="ab07a8b0ce79c80e9baf75c3e82f56937" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::sendProbe </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends 1 bytes as "probe", called by the "persist" mechanism </p>

<p>Referenced by <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00229">tcp_old::TCPBaseAlg::processPersistTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00573"></a>00573 {
<a name="l00574"></a>00574     <span class="comment">// we&#39;ll start sending from snd_max</span>
<a name="l00575"></a>00575     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     <span class="comment">// check we have 1 byte to send</span>
<a name="l00578"></a>00578     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#acf03e0bbf6565ae7df7afa656d97ca18">getBytesAvailable</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>)==0)
<a name="l00579"></a>00579     {
<a name="l00580"></a>00580         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Cannot send probe because send buffer is empty\n&quot;</span>;
<a name="l00581"></a>00581         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584     uint32 old_snd_nxt = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending 1 byte as probe, with seq=&quot;</span> &lt;&lt; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00587"></a>00587     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(1);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="comment">// remember highest seq sent (snd_nxt may be set back on retransmission,</span>
<a name="l00590"></a>00590     <span class="comment">// but we&#39;ll need snd_max to check validity of ACKs -- they must ack</span>
<a name="l00591"></a>00591     <span class="comment">// something we really sent)</span>
<a name="l00592"></a>00592     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>;
<a name="l00593"></a>00593     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">unackedVector</a>-&gt;record(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> - <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ace4a453b30bdffb99c1c0646fba597dc">snd_una</a>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="comment">// notify</span>
<a name="l00596"></a>00596     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a522fdc8f478a358787e1a21a543532e2">ackSent</a>();
<a name="l00597"></a>00597     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a2a8e9ea9d181d94d837c4ca41d38627b">dataSent</a>(old_snd_nxt);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00600"></a>00600 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3dc25263bb2f0b1013ee398c1587b128"></a><!-- doxytag: member="tcp_old::TCPConnection::sendRst" ref="a3dc25263bb2f0b1013ee398c1587b128" args="(uint32 seq, IPvXAddress src, IPvXAddress dest, int srcPort, int destPort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRst </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>srcPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>destPort</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST; does not use connection state </p>

<p><div class="fragment"><pre class="fragment"><a name="l00382"></a>00382 {
<a name="l00383"></a>00383     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;RST&quot;</span>);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aecde52ccc2594bb4820fab0ad6638e7b">setSrcPort</a>(srcPort);
<a name="l00386"></a>00386     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4f39849c340ca1247b69f1c5cddd08b0">setDestPort</a>(destPort);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a04290a07e85bde263cc224726089cee5">setRstBit</a>(<span class="keyword">true</span>);
<a name="l00389"></a>00389     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(seq);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="comment">// send it</span>
<a name="l00392"></a>00392     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg, src, dest);
<a name="l00393"></a>00393 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afa03f88fc4589249aefe6f828eed9dd6"></a><!-- doxytag: member="tcp_old::TCPConnection::sendRst" ref="afa03f88fc4589249aefe6f828eed9dd6" args="(uint32 seqNo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRst </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>seqNo</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00222">process_ABORT()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00037">segmentArrivalWhileClosed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00377"></a>00377 {
<a name="l00378"></a>00378     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(seqNo, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a>);
<a name="l00379"></a>00379 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade3c9c38be0aa758b4eb448d5c1169b9"></a><!-- doxytag: member="tcp_old::TCPConnection::sendRstAck" ref="ade3c9c38be0aa758b4eb448d5c1169b9" args="(uint32 seq, uint32 ack, IPvXAddress src, IPvXAddress dest, int srcPort, int destPort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRstAck </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>ack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>srcPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>destPort</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST+ACK; does not use connection state </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00037">segmentArrivalWhileClosed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00396"></a>00396 {
<a name="l00397"></a>00397     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;RST+ACK&quot;</span>);
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aecde52ccc2594bb4820fab0ad6638e7b">setSrcPort</a>(srcPort);
<a name="l00400"></a>00400     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4f39849c340ca1247b69f1c5cddd08b0">setDestPort</a>(destPort);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a04290a07e85bde263cc224726089cee5">setRstBit</a>(<span class="keyword">true</span>);
<a name="l00403"></a>00403     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00404"></a>00404     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(seq);
<a name="l00405"></a>00405     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(ack);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="comment">// send it</span>
<a name="l00408"></a>00408     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg, src, dest);
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="comment">// notify</span>
<a name="l00411"></a>00411     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a522fdc8f478a358787e1a21a543532e2">ackSent</a>();
<a name="l00412"></a>00412 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af71155c4fad49ea52907d840463a06d5"></a><!-- doxytag: member="tcp_old::TCPConnection::sendSegment" ref="af71155c4fad49ea52907d840463a06d5" args="(uint32 bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSegment </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>bytes</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends one segment of 'bytes' bytes from snd_nxt, and advances snd_nxt. <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab2cbccc16b2f006369a83c51426e4bc5">sendData()</a>, <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe()</a> and <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData()</a> internally all rely on this one. </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00623">retransmitData()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00602">retransmitOneSegment()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00480">sendData()</a>, and <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00572">sendProbe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00450"></a>00450 {
<a name="l00451"></a>00451     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#acf03e0bbf6565ae7df7afa656d97ca18">getBytesAvailable</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>);
<a name="l00452"></a>00452     <span class="keywordflow">if</span> (bytes &gt; buffered) <span class="comment">// last segment?</span>
<a name="l00453"></a>00453         bytes = buffered;
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="comment">// send one segment of &#39;bytes&#39; bytes from snd_nxt, and advance snd_nxt</span>
<a name="l00456"></a>00456     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">sendQueue</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_send_queue.html#aa2bd6a59bbf6f5adf7ce1d73e374d7fa">createSegmentWithBytes</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>, bytes);
<a name="l00457"></a>00457     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>);
<a name="l00458"></a>00458     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00459"></a>00459     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ab26a1e5c5f13a245ef7578dc87e81cfe">rcv_wnd</a>);
<a name="l00460"></a>00460     <span class="comment">// TBD when to set PSH bit?</span>
<a name="l00461"></a>00461     <span class="comment">// TBD set URG bit if needed</span>
<a name="l00462"></a>00462     ASSERT(bytes==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>());
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> += bytes;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     <span class="comment">// check if afterRto bit can be reset</span>
<a name="l00467"></a>00467     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a3a3438ec884f8d063558f87d793c1fee">afterRto</a> &amp;&amp; <a class="code" href="namespacetcp__old.html#a0012c6f2a0631480574729efd85a05c9">seqGE</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a>))
<a name="l00468"></a>00468         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a3a3438ec884f8d063558f87d793c1fee">afterRto</a> = <span class="keyword">false</span>;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     if (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a2a8d544b5707071afcc5402e6318e245">send_fin</a> &amp;&amp; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a>==<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a1156c4cdd71d0e83c9bb401a68e9f606">snd_fin_seq</a>)
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Setting FIN on segment\n&quot;</span>;
<a name="l00473"></a>00473         tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a626c808550da11fa9ea1bdce32409784">setFinBit</a>(<span class="keyword">true</span>);
<a name="l00474"></a>00474         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a1156c4cdd71d0e83c9bb401a68e9f606">snd_fin_seq</a>+1;
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00478"></a>00478 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abcd8f7efecc7c0077050184d3384b493"></a><!-- doxytag: member="tcp_old::TCPConnection::sendSyn" ref="abcd8f7efecc7c0077050184d3384b493" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSyn </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send SYN </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01125">process_TIMEOUT_SYN_REXMIT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00339"></a>00339 {
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>() || <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a>==-1)
<a name="l00341"></a>00341         opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: foreign socket unspecified&quot;</span>);
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>==-1)
<a name="l00343"></a>00343         opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: local port unspecified&quot;</span>);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="comment">// create segment</span>
<a name="l00346"></a>00346     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;SYN&quot;</span>);
<a name="l00347"></a>00347     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>);
<a name="l00348"></a>00348     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#ae6ab03cf0b027aa91c0dfae3e92f4099">setSynBit</a>(<span class="keyword">true</span>);
<a name="l00349"></a>00349     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ab26a1e5c5f13a245ef7578dc87e81cfe">rcv_wnd</a>);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>+1;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="comment">// send it</span>
<a name="l00354"></a>00354     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00355"></a>00355 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a675b131a43de7429552a574cabcc12dd"></a><!-- doxytag: member="tcp_old::TCPConnection::sendSynAck" ref="a675b131a43de7429552a574cabcc12dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSynAck </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send SYN+ACK </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01125">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00358"></a>00358 {
<a name="l00359"></a>00359     <span class="comment">// create segment</span>
<a name="l00360"></a>00360     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;SYN+ACK&quot;</span>);
<a name="l00361"></a>00361     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>);
<a name="l00362"></a>00362     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a18b8a2c7e52c332378bd9f70b1d91b29">rcv_nxt</a>);
<a name="l00363"></a>00363     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#ae6ab03cf0b027aa91c0dfae3e92f4099">setSynBit</a>(<span class="keyword">true</span>);
<a name="l00364"></a>00364     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00365"></a>00365     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#ab26a1e5c5f13a245ef7578dc87e81cfe">rcv_wnd</a>);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a7589e90fe54f9579ab547d55760b4d17">snd_max</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#acab59efee35f446ab6310db804cd164d">snd_nxt</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a74b7f93c1777b2428f37a7b8d2d8a5a4">iss</a>+1;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     <span class="comment">// send it</span>
<a name="l00370"></a>00370     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="comment">// notify</span>
<a name="l00373"></a>00373     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a522fdc8f478a358787e1a21a543532e2">ackSent</a>();
<a name="l00374"></a>00374 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6aa48826843116a0f5c4e0fa37a69cfc"></a><!-- doxytag: member="tcp_old::TCPConnection::sendToApp" ref="a6aa48826843116a0f5c4e0fa37a69cfc" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToApp </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends packet to application </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00253">process_STATUS()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00279"></a>00279 {
<a name="l00280"></a>00280     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">appGateIndex</a>);
<a name="l00281"></a>00281 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8763146770969da7d0a1196efe23615c"></a><!-- doxytag: member="tcp_old::TCPConnection::sendToIP" ref="a8763146770969da7d0a1196efe23615c" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToIP </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send <a class="el" href="class_i_p.html">IP</a> packet </p>

<p><div class="fragment"><pre class="fragment"><a name="l00212"></a>00212 {
<a name="l00213"></a>00213     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending: &quot;</span>;
<a name="l00214"></a>00214     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (!dest.<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>())
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218         <span class="comment">// send over IPv4</span>
<a name="l00219"></a>00219         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
<a name="l00220"></a>00220         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#ac2a2013d2125ebfcbdd6ea9943eabd41">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70a69fd8777dfd279b247a88b6eec793bd7">IP_PROT_TCP</a>);
<a name="l00221"></a>00221         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8e6ca2ce04f482ba99ac4064f83a414d">setSrcAddr</a>(src.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00222"></a>00222         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a135b0ce268713460864e7291dbe6eb5c">setDestAddr</a>(dest.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00223"></a>00223         tcpseg-&gt;setControlInfo(controlInfo);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         check_and_cast&lt;<a class="code" href="classtcp__old_1_1_t_c_p.html">TCP</a> *&gt;(simulation.getContextModule())-&gt;send(tcpseg,<span class="stringliteral">&quot;ipOut&quot;</span>);
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     <span class="keywordflow">else</span>
<a name="l00228"></a>00228     {
<a name="l00229"></a>00229         <span class="comment">// send over IPv6</span>
<a name="l00230"></a>00230         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
<a name="l00231"></a>00231         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a1d7bdca688829aec49c5ba5bcbbad43a">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70a69fd8777dfd279b247a88b6eec793bd7">IP_PROT_TCP</a>);
<a name="l00232"></a>00232         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#ae038bde950f03730e1765a4f037c9c17">setSrcAddr</a>(src.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00233"></a>00233         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a33ad14801b514f598753f68ece7ccc27">setDestAddr</a>(dest.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00234"></a>00234         tcpseg-&gt;setControlInfo(controlInfo);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         check_and_cast&lt;<a class="code" href="classtcp__old_1_1_t_c_p.html">TCP</a> *&gt;(simulation.getContextModule())-&gt;send(tcpseg,<span class="stringliteral">&quot;ipv6Out&quot;</span>);
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a86143cf35f957006c5fe17c506be21c7"></a><!-- doxytag: member="tcp_old::TCPConnection::sendToIP" ref="a86143cf35f957006c5fe17c506be21c7" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToIP </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: adds control info to segment and sends it to <a class="el" href="class_i_p.html">IP</a> </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00414">sendAck()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00430">sendFin()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00381">sendRst()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00395">sendRstAck()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00449">sendSegment()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00338">sendSyn()</a>, and <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00357">sendSynAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00170"></a>00170 {
<a name="l00171"></a>00171     <span class="comment">// record seq (only if we do send data) and ackno</span>
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a946bf6fc849e9554b489e5fff58be513">sndNxtVector</a> &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()!=0)
<a name="l00173"></a>00173         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a946bf6fc849e9554b489e5fff58be513">sndNxtVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>());
<a name="l00174"></a>00174     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afe2cc9a34e2074f95626e4085236d561">sndAckVector</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#afe2cc9a34e2074f95626e4085236d561">sndAckVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>());
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="comment">// final touches on the segment before sending</span>
<a name="l00177"></a>00177     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aecde52ccc2594bb4820fab0ad6638e7b">setSrcPort</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">localPort</a>);
<a name="l00178"></a>00178     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4f39849c340ca1247b69f1c5cddd08b0">setDestPort</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">remotePort</a>);
<a name="l00179"></a>00179     tcpseg-&gt;setByteLength(<a class="code" href="_t_c_p_segment__m_8h.html#a77315d68700647283fc64814a5862090">TCP_HEADER_OCTETS</a>+tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>());
<a name="l00180"></a>00180     <span class="comment">// TBD account for Options (once they get implemented)</span>
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending: &quot;</span>;
<a name="l00183"></a>00183     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <span class="comment">// TBD reuse next function for sending</span>
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="keywordflow">if</span> (!<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>())
<a name="l00188"></a>00188     {
<a name="l00189"></a>00189         <span class="comment">// send over IPv4</span>
<a name="l00190"></a>00190         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
<a name="l00191"></a>00191         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#ac2a2013d2125ebfcbdd6ea9943eabd41">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70a69fd8777dfd279b247a88b6eec793bd7">IP_PROT_TCP</a>);
<a name="l00192"></a>00192         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8e6ca2ce04f482ba99ac4064f83a414d">setSrcAddr</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00193"></a>00193         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a135b0ce268713460864e7291dbe6eb5c">setDestAddr</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00194"></a>00194         tcpseg-&gt;setControlInfo(controlInfo);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;send(tcpseg,<span class="stringliteral">&quot;ipOut&quot;</span>);
<a name="l00197"></a>00197     }
<a name="l00198"></a>00198     <span class="keywordflow">else</span>
<a name="l00199"></a>00199     {
<a name="l00200"></a>00200         <span class="comment">// send over IPv6</span>
<a name="l00201"></a>00201         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
<a name="l00202"></a>00202         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a1d7bdca688829aec49c5ba5bcbbad43a">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70a69fd8777dfd279b247a88b6eec793bd7">IP_PROT_TCP</a>);
<a name="l00203"></a>00203         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#ae038bde950f03730e1765a4f037c9c17">setSrcAddr</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00204"></a>00204         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a33ad14801b514f598753f68ece7ccc27">setDestAddr</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00205"></a>00205         tcpseg-&gt;setControlInfo(controlInfo);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcpMain</a>-&gt;send(tcpseg,<span class="stringliteral">&quot;ipv6Out&quot;</span>);
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a264eb196b44591ed68422a9e70dab680"></a><!-- doxytag: member="tcp_old::TCPConnection::signalConnectionTimeout" ref="a264eb196b44591ed68422a9e70dab680" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::signalConnectionTimeout </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: signal to user that connection timed out </p>

<p>Referenced by <a class="el" href="old_2flavours_2_t_c_p_base_alg_8cc_source.html#l00179">tcp_old::TCPBaseAlg::processRexmitTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00246"></a>00246 {
<a name="l00247"></a>00247     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba06629e44a0aef5201b4cd424596127bf">TCP_I_TIMED_OUT</a>);
<a name="l00248"></a>00248 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa58f44bc38ec0af46aca654f9403771f"></a><!-- doxytag: member="tcp_old::TCPConnection::startSynRexmitTimer" ref="aa58f44bc38ec0af46aca654f9403771f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::startSynRexmitTimer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: start SYN-REXMIT timer </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01116"></a>01116 {
<a name="l01117"></a>01117     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#add0426103a74138a0599e58049526e8a">syn_rexmit_count</a> = 0;
<a name="l01118"></a>01118     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a9aec9c42959150643d39bde968908d39">syn_rexmit_timeout</a> = <a class="code" href="_t_c_p_connection_8h.html#a89ce38305130a5021e21134602a88f79">TCP_TIMEOUT_SYN_REXMIT</a>;
<a name="l01119"></a>01119 
<a name="l01120"></a>01120     <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>-&gt;isScheduled())
<a name="l01121"></a>01121         <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>);
<a name="l01122"></a>01122     <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae1ff44c73d20293a446adc091842bedd">scheduleTimeout</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>, <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_state_variables.html#a9aec9c42959150643d39bde968908d39">syn_rexmit_timeout</a>);
<a name="l01123"></a>01123 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1be68d20f98e68b01ef9267a8dd2088a"></a><!-- doxytag: member="tcp_old::TCPConnection::stateEntered" ref="a1be68d20f98e68b01ef9267a8dd2088a" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::stateEntered </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Perform cleanup necessary when entering a new state, e.g. cancelling timers </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00284">performStateTransition()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00450"></a>00450 {
<a name="l00451"></a>00451     <span class="comment">// cancel timers</span>
<a name="l00452"></a>00452     <span class="keywordflow">switch</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>)
<a name="l00453"></a>00453     {
<a name="l00454"></a>00454         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>:
<a name="l00455"></a>00455             <span class="comment">// we&#39;ll never get back to INIT</span>
<a name="l00456"></a>00456             <span class="keywordflow">break</span>;
<a name="l00457"></a>00457         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>:
<a name="l00458"></a>00458             <span class="comment">// we may get back to LISTEN from SYN_RCVD</span>
<a name="l00459"></a>00459             ASSERT(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a> &amp;&amp; <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>);
<a name="l00460"></a>00460             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>);
<a name="l00461"></a>00461             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>);
<a name="l00462"></a>00462             <span class="keywordflow">break</span>;
<a name="l00463"></a>00463         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>:
<a name="l00464"></a>00464         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>:
<a name="l00465"></a>00465             <span class="keywordflow">break</span>;
<a name="l00466"></a>00466         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>:
<a name="l00467"></a>00467             <span class="comment">// we&#39;re in ESTABLISHED, these timers are no longer needed</span>
<a name="l00468"></a>00468             <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>);
<a name="l00469"></a>00469             <span class="keyword">delete</span> <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>);
<a name="l00470"></a>00470             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a> = <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a> = NULL;
<a name="l00471"></a>00471             <span class="comment">// TCP_I_ESTAB notification moved inside event processing</span>
<a name="l00472"></a>00472             <span class="keywordflow">break</span>;
<a name="l00473"></a>00473         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>:
<a name="l00474"></a>00474         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>:
<a name="l00475"></a>00475         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>:
<a name="l00476"></a>00476         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>:
<a name="l00477"></a>00477         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a>:
<a name="l00478"></a>00478         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>:
<a name="l00479"></a>00479             <span class="comment">// whether connection setup succeeded (ESTABLISHED) or not (others),</span>
<a name="l00480"></a>00480             <span class="comment">// cancel these timers</span>
<a name="l00481"></a>00481             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>);
<a name="l00482"></a>00482             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>);
<a name="l00483"></a>00483             <span class="keywordflow">break</span>;
<a name="l00484"></a>00484         <span class="keywordflow">case</span> <a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>:
<a name="l00485"></a>00485             <span class="comment">// all timers need to be cancelled</span>
<a name="l00486"></a>00486             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>)   <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">the2MSLTimer</a>);
<a name="l00487"></a>00487             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">connEstabTimer</a>);
<a name="l00488"></a>00488             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>)  <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">finWait2Timer</a>);
<a name="l00489"></a>00489             <span class="keywordflow">if</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>) <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad06a2b75a619021592db07ab486f0fed">cancelEvent</a>(<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">synRexmitTimer</a>);
<a name="l00490"></a>00490             <a class="code" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcpAlgorithm</a>-&gt;<a class="code" href="classtcp__old_1_1_t_c_p_algorithm.html#a3f274c87ed54d3828b9d7908d45aeb70">connectionClosed</a>();
<a name="l00491"></a>00491             <span class="keywordflow">break</span>;
<a name="l00492"></a>00492     }
<a name="l00493"></a>00493 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab991cf2680a63832310a4a56ac17972e"></a><!-- doxytag: member="tcp_old::TCPConnection::stateName" ref="ab991cf2680a63832310a4a56ac17972e" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::stateName </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_S_xxx constants </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00284">performStateTransition()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00109">printConnBrief()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00253">process_STATUS()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01079">process_TIMEOUT_2MSL()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01059">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01100">process_TIMEOUT_FIN_WAIT_2()</a>, and <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01125">process_TIMEOUT_SYN_REXMIT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00038"></a>00038 {
<a name="l00039"></a>00039 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00041"></a>00041     <span class="keywordflow">switch</span> (<a class="code" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">state</a>)
<a name="l00042"></a>00042     {
<a name="l00043"></a>00043         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8b6438b06a8e3cd7537e09f9fb2f0d03">TCP_S_INIT</a>);
<a name="l00044"></a>00044         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaae392e6982b73d95ab4e48e3a27ce552">TCP_S_CLOSED</a>);
<a name="l00045"></a>00045         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a809324e3edea6ff6800a639d7bcea2">TCP_S_LISTEN</a>);
<a name="l00046"></a>00046         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaafde4b4cc43d59d14ba2cbf0bc3adb525">TCP_S_SYN_SENT</a>);
<a name="l00047"></a>00047         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaf96abc23364b3cdd51216d5cc9a4f3fc">TCP_S_SYN_RCVD</a>);
<a name="l00048"></a>00048         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3b4387f45a765235dfda0bf3111ba1c6">TCP_S_ESTABLISHED</a>);
<a name="l00049"></a>00049         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa3395b6fd6b4cf5d6165b37929d44eaa1">TCP_S_CLOSE_WAIT</a>);
<a name="l00050"></a>00050         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaac5147b505ddf6bb15d84853242bcfdf">TCP_S_LAST_ACK</a>);
<a name="l00051"></a>00051         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa1366e9fbbf862cd3fdfa3ea08e641cb0">TCP_S_FIN_WAIT_1</a>);
<a name="l00052"></a>00052         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaaea07c6aa092a0b2e9141385fb4734797">TCP_S_FIN_WAIT_2</a>);
<a name="l00053"></a>00053         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaacdbad950a89de6fc964c3257d45e07a9">TCP_S_CLOSING</a>);
<a name="l00054"></a>00054         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="namespacetcp__old.html#acdbb7986967662f90bca9b6ef46f3acaa8a4fa6fa69c727999ad6b8fe056a6fd1">TCP_S_TIME_WAIT</a>);
<a name="l00055"></a>00055     }
<a name="l00056"></a>00056     <span class="keywordflow">return</span> s;
<a name="l00057"></a>00057 <span class="preprocessor">#undef CASE</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9b7d3f811eab0367d3826dfb20c8d931"></a><!-- doxytag: member="tcp_old::TCPConnection::tryFastRoute" ref="a9b7d3f811eab0367d3826dfb20c8d931" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::tryFastRoute </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Shortcut to process most common case as fast as possible. Returns false if segment requires normal (slow) route. </p>

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00221">processTCPSegment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00031"></a>00031 {
<a name="l00032"></a>00032     <span class="comment">// fast route processing not yet implemented</span>
<a name="l00033"></a>00033     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00034"></a>00034 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ad04d1e9fb23f48cd53dcd7c411caea80"></a><!-- doxytag: member="tcp_old::TCPConnection::appGateIndex" ref="ad04d1e9fb23f48cd53dcd7c411caea80" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ad04d1e9fb23f48cd53dcd7c411caea80">tcp_old::TCPConnection::appGateIndex</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00360">tcp_old::TCP::addForkedConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00109">printConnBrief()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00380">tcp_old::TCP::removeConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00261">sendEstabIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00250">sendIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00278">sendToApp()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00114">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a757386355261e95064b75f2dfec3788e"></a><!-- doxytag: member="tcp_old::TCPConnection::connEstabTimer" ref="a757386355261e95064b75f2dfec3788e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a757386355261e95064b75f2dfec3788e">tcp_old::TCPConnection::connEstabTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00449">stateEntered()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ae6ce2bfc0b9aa9d110db13efe08b7a0e"></a><!-- doxytag: member="tcp_old::TCPConnection::connId" ref="ae6ce2bfc0b9aa9d110db13efe08b7a0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae6ce2bfc0b9aa9d110db13efe08b7a0e">tcp_old::TCPConnection::connId</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00360">tcp_old::TCP::addForkedConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00109">printConnBrief()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00380">tcp_old::TCP::removeConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00261">sendEstabIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00250">sendIndicationToApp()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00114">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a2a3d3f1792941e08c490795d1d2a4bc0"></a><!-- doxytag: member="tcp_old::TCPConnection::finWait2Timer" ref="a2a3d3f1792941e08c490795d1d2a4bc0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a2a3d3f1792941e08c490795d1d2a4bc0">tcp_old::TCPConnection::finWait2Timer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00449">stateEntered()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a3b7998c1cae436f8d35cabdb073d3881"></a><!-- doxytag: member="tcp_old::TCPConnection::fsm" ref="a3b7998c1cae436f8d35cabdb073d3881" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cFSM <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a3b7998c1cae436f8d35cabdb073d3881">tcp_old::TCPConnection::fsm</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00284">performStateTransition()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00109">printConnBrief()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00222">process_ABORT()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00161">process_CLOSE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00080">process_OPEN_PASSIVE()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00253">process_STATUS()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01079">process_TIMEOUT_2MSL()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01059">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01100">process_TIMEOUT_FIN_WAIT_2()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01125">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00937">processAckInEstabEtc()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00114">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="adc50d816f66c74441b608b01ed4800c7"></a><!-- doxytag: member="tcp_old::TCPConnection::localAddr" ref="adc50d816f66c74441b608b01ed4800c7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#adc50d816f66c74441b608b01ed4800c7">tcp_old::TCPConnection::localAddr</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00360">tcp_old::TCP::addForkedConnection()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00306">tcp_old::TCP::addSockPair()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00109">printConnBrief()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00080">process_OPEN_PASSIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00253">process_STATUS()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00221">processTCPSegment()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00380">tcp_old::TCP::removeConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00261">sendEstabIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00376">sendRst()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00169">sendToIP()</a>, and <a class="el" href="old_2_t_c_p_8cc_source.html#l00336">tcp_old::TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="a3af4312fbe2cd46bb1be1daf65715258"></a><!-- doxytag: member="tcp_old::TCPConnection::localPort" ref="a3af4312fbe2cd46bb1be1daf65715258" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a3af4312fbe2cd46bb1be1daf65715258">tcp_old::TCPConnection::localPort</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00360">tcp_old::TCP::addForkedConnection()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00306">tcp_old::TCP::addSockPair()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00109">printConnBrief()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00080">process_OPEN_PASSIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00253">process_STATUS()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00221">processTCPSegment()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00380">tcp_old::TCP::removeConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00261">sendEstabIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00376">sendRst()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00338">sendSyn()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00169">sendToIP()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00114">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_8cc_source.html#l00336">tcp_old::TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="a7b6c1fcdd10a035c035dea350420286d"></a><!-- doxytag: member="tcp_old::TCPConnection::rcvAckVector" ref="a7b6c1fcdd10a035c035dea350420286d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a7b6c1fcdd10a035c035dea350420286d">tcp_old::TCPConnection::rcvAckVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="acb4230bb789e0bf3e413479e26316d60"></a><!-- doxytag: member="tcp_old::TCPConnection::rcvSeqVector" ref="acb4230bb789e0bf3e413479e26316d60" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#acb4230bb789e0bf3e413479e26316d60">tcp_old::TCPConnection::rcvSeqVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a2602ec64d45270793076abe5938d16ac"></a><!-- doxytag: member="tcp_old::TCPConnection::receiveQueue" ref="a2602ec64d45270793076abe5938d16ac" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_receive_queue.html">TCPReceiveQueue</a>* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a2602ec64d45270793076abe5938d16ac">tcp_old::TCPConnection::receiveQueue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00283">initConnection()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ad54931b7375eb7b6e51ca9862cb0a714"></a><!-- doxytag: member="tcp_old::TCPConnection::remoteAddr" ref="ad54931b7375eb7b6e51ca9862cb0a714" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ad54931b7375eb7b6e51ca9862cb0a714">tcp_old::TCPConnection::remoteAddr</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00360">tcp_old::TCP::addForkedConnection()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00306">tcp_old::TCP::addSockPair()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00109">printConnBrief()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00253">process_STATUS()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00221">processTCPSegment()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00380">tcp_old::TCP::removeConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00261">sendEstabIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00376">sendRst()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00338">sendSyn()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00169">sendToIP()</a>, and <a class="el" href="old_2_t_c_p_8cc_source.html#l00336">tcp_old::TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="aece396520a4675f35694895f37b35f88"></a><!-- doxytag: member="tcp_old::TCPConnection::remotePort" ref="aece396520a4675f35694895f37b35f88" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#aece396520a4675f35694895f37b35f88">tcp_old::TCPConnection::remotePort</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_8cc_source.html#l00360">tcp_old::TCP::addForkedConnection()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00306">tcp_old::TCP::addSockPair()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00109">printConnBrief()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00253">process_STATUS()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00221">processTCPSegment()</a>, <a class="el" href="old_2_t_c_p_8cc_source.html#l00380">tcp_old::TCP::removeConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00261">sendEstabIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00376">sendRst()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00338">sendSyn()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00169">sendToIP()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00114">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_8cc_source.html#l00336">tcp_old::TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="a7bd9b6b2b4422771b92e00d307983d19"></a><!-- doxytag: member="tcp_old::TCPConnection::sendQueue" ref="a7bd9b6b2b4422771b92e00d307983d19" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_send_queue.html">TCPSendQueue</a>* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a7bd9b6b2b4422771b92e00d307983d19">tcp_old::TCPConnection::sendQueue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00283">initConnection()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00161">process_CLOSE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00937">processAckInEstabEtc()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00909">processRstInSynReceived()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00623">retransmitData()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00320">selectInitialSeqNum()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00480">sendData()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00572">sendProbe()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00449">sendSegment()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="afe2cc9a34e2074f95626e4085236d561"></a><!-- doxytag: member="tcp_old::TCPConnection::sndAckVector" ref="afe2cc9a34e2074f95626e4085236d561" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#afe2cc9a34e2074f95626e4085236d561">tcp_old::TCPConnection::sndAckVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00169">sendToIP()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a946bf6fc849e9554b489e5fff58be513"></a><!-- doxytag: member="tcp_old::TCPConnection::sndNxtVector" ref="a946bf6fc849e9554b489e5fff58be513" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a946bf6fc849e9554b489e5fff58be513">tcp_old::TCPConnection::sndNxtVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00169">sendToIP()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ab58ab42e2f19a58edcfa549b51a7179b"></a><!-- doxytag: member="tcp_old::TCPConnection::sndWndVector" ref="ab58ab42e2f19a58edcfa549b51a7179b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ab58ab42e2f19a58edcfa549b51a7179b">tcp_old::TCPConnection::sndWndVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00937">processAckInEstabEtc()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ae549dc567d3d71f2981c3be27cee0ccb"></a><!-- doxytag: member="tcp_old::TCPConnection::state" ref="ae549dc567d3d71f2981c3be27cee0ccb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_state_variables.html">TCPStateVariables</a>* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ae549dc567d3d71f2981c3be27cee0ccb">tcp_old::TCPConnection::state</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00311">configureStateVariables()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00283">initConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00330">isSegmentAcceptable()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00284">performStateTransition()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00222">process_ABORT()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00161">process_CLOSE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00080">process_OPEN_PASSIVE()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00253">process_STATUS()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01059">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01125">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00937">processAckInEstabEtc()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00909">processRstInSynReceived()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00623">retransmitData()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00602">retransmitOneSegment()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00037">segmentArrivalWhileClosed()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00320">selectInitialSeqNum()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00414">sendAck()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00480">sendData()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00430">sendFin()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00572">sendProbe()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00449">sendSegment()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00338">sendSyn()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00357">sendSynAck()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01115">startSynRexmitTimer()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ad70c187b499189b370f99433eb825dcd"></a><!-- doxytag: member="tcp_old::TCPConnection::synRexmitTimer" ref="ad70c187b499189b370f99433eb825dcd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#ad70c187b499189b370f99433eb825dcd">tcp_old::TCPConnection::synRexmitTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01125">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l01115">startSynRexmitTimer()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00449">stateEntered()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a2212cb0deb11d2b1c5826cab57b3f42e"></a><!-- doxytag: member="tcp_old::TCPConnection::tcpAlgorithm" ref="a2212cb0deb11d2b1c5826cab57b3f42e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p_algorithm.html">TCPAlgorithm</a>* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a2212cb0deb11d2b1c5826cab57b3f42e">tcp_old::TCPConnection::tcpAlgorithm</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00283">initConnection()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00161">process_CLOSE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00113">process_SEND()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00937">processAckInEstabEtc()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00602">retransmitOneSegment()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00414">sendAck()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00480">sendData()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00430">sendFin()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00572">sendProbe()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00395">sendRstAck()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00357">sendSynAck()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00449">stateEntered()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a6f9eb8f2af118d2f1fcd90df3c87249e"></a><!-- doxytag: member="tcp_old::TCPConnection::tcpMain" ref="a6f9eb8f2af118d2f1fcd90df3c87249e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtcp__old_1_1_t_c_p.html">TCP</a>* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a6f9eb8f2af118d2f1fcd90df3c87249e">tcp_old::TCPConnection::tcpMain</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00138">cloneListeningConnection()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00311">configureStateVariables()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00283">initConnection()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00284">performStateTransition()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00034">process_OPEN_ACTIVE()</a>, <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00080">process_OPEN_PASSIVE()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00622">processSegmentInListen()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00741">processSegmentInSynSent()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00261">sendEstabIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00250">sendIndicationToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00278">sendToApp()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00169">sendToIP()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00114">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a67c3fa718ee0542b4bd93eda8785c0fc"></a><!-- doxytag: member="tcp_old::TCPConnection::the2MSLTimer" ref="a67c3fa718ee0542b4bd93eda8785c0fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a67c3fa718ee0542b4bd93eda8785c0fc">tcp_old::TCPConnection::the2MSLTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00184">processTimer()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00449">stateEntered()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a529775c184153f33ff75a91bacc8b0fc"></a><!-- doxytag: member="tcp_old::TCPConnection::unackedVector" ref="a529775c184153f33ff75a91bacc8b0fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="classtcp__old_1_1_t_c_p_connection.html#a529775c184153f33ff75a91bacc8b0fc">tcp_old::TCPConnection::unackedVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="old_2_t_c_p_connection_event_proc_8cc_source.html#l00161">process_CLOSE()</a>, <a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc_source.html#l00937">processAckInEstabEtc()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00480">sendData()</a>, <a class="el" href="old_2_t_c_p_connection_util_8cc_source.html#l00572">sendProbe()</a>, <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00098">TCPConnection()</a>, and <a class="el" href="old_2_t_c_p_connection_base_8cc_source.html#l00163">~TCPConnection()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_t_c_p_connection__old_8h.html">TCPConnection_old.h</a></li>
<li><a class="el" href="old_2_t_c_p_connection_base_8cc.html">old/TCPConnectionBase.cc</a></li>
<li><a class="el" href="old_2_t_c_p_connection_event_proc_8cc.html">old/TCPConnectionEventProc.cc</a></li>
<li><a class="el" href="old_2_t_c_p_connection_rcv_segment_8cc.html">old/TCPConnectionRcvSegment.cc</a></li>
<li><a class="el" href="old_2_t_c_p_connection_util_8cc.html">old/TCPConnectionUtil.cc</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Jul 22 20:01:49 2010 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
